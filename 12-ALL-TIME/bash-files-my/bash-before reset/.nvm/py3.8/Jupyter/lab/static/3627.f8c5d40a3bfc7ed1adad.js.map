{"version":3,"sources":["webpack://@jupyterlab/application-top/./node_modules/dexie/dist/dexie.mjs"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__spreadArrays","il","r","Array","k","a","j","jl","keys","isArray","_global","self","window","global","Promise","extend","obj","extension","forEach","key","getProto","getPrototypeOf","_hasOwn","hasOwn","prop","props","proto","setProp","defineProperty","functionOrGetSet","options","get","set","configurable","value","writable","derive","Child","from","Parent","create","bind","getOwnPropertyDescriptor","getPropertyDescriptor","pd","_slice","slice","args","start","end","override","origFunc","overridedFactory","assert","b","Error","asap","fn","setImmediate","setTimeout","arrayToObject","array","extractor","reduce","result","item","nameAndValue","tryCatch","onerror","ex","getByKeyPath","keyPath","rv","l","val","push","period","indexOf","innerObj","substr","undefined","setByKeyPath","isFrozen","currentKeyPath","remainingKeyPath","isNaN","parseInt","splice","delByKeyPath","map","kp","shallowClone","m","concat","flatten","intrinsicTypeNames","split","num","filter","intrinsicTypes","intrinsicTypeNameSet","x","deepClone","any","constructor","toString","toStringTag","o","getValueOf","type","v","Uint8Array","getTime","ArrayBuffer","isView","buffer","getObjectDiff","prfx","ap","bp","apTypeName","bpTypeName","iteratorSymbol","Symbol","iterator","getIteratorOf","NO_CHAR_ARRAY","getArrayOf","arrayLike","it","next","done","isAsyncFunction","debug","location","test","href","setDebug","libraryFilter","NEEDS_THROW_FOR_STACK","stack","getErrorWithStack","e","prettyStack","exception","numIgnoredFrames","name","message","frame","join","dexieErrorNames","idbDomErrorNames","errorList","defaultTexts","VersionChanged","DatabaseClosed","Abort","TransactionInactive","DexieError","msg","_e","_stack","getMultiErrorMessage","failures","ModifyError","successCount","failedKeys","BulkError","errnames","BaseException","exceptions","fullName","msgOrInner","inner","Syntax","SyntaxError","Type","TypeError","Range","RangeError","exceptionMap","mapError","domError","fullNameExceptions","nop","mirror","pureFunctionChain","f1","f2","callBoth","on1","on2","hookCreatingChain","res","onsuccess","res2","hookDeletingChain","hookUpdatingChain","modifications","reverseStoppableEventChain","promisableChain","then","thiz","INTERNAL","LONG_STACKS_CLIP_LIMIT","MAX_LONG_STACKS","ZONE_ECHO_LIMIT","_a","globalP","resolve","crypto","subtle","__proto__","nativeP","digest","resolvedNativePromise","nativePromiseProto","resolvedGlobalPromise","nativePromiseThen","NativePromise","patchGlobalPromise","stack_being_generated","schedulePhysicalTick","physicalTick","MutationObserver","hiddenDiv","document","createElement","observe","attributes","setAttribute","asap$1","callback","microtickQueue","needsNewPhysicalTick","isOutsideMicroTick","unhandledErrors","rejectingErrors","currentFulfiller","rejectionMapper","globalPSD","id","ref","unhandleds","onunhandled","globalError","pgp","env","finalize","uh","PSD","numScheduledCalls","tickFinalizers","DexiePromise","_listeners","onuncatched","_lib","psd","_PSD","_stackHolder","_prev","_numPrev","_state","_value","handleRejection","executePromiseTask","thenProp","microTaskId","totalEchoes","onFulfilled","onRejected","_this","possibleAwait","cleanup","decrementExpectedAwaits","reject","propagateToListener","Listener","nativeAwaitCompatibleWrap","linkToPreviousPromise","_then","catch","handler","err","PromiseReject","finally","onFinally","stacks","getStack","timeout","ms","Infinity","handle","Timeout","clearTimeout","snapShot","zone","all","values","onPossibleParallellAsync","remaining","race","newPSD","newScope","usePSD","scheduler","follow","zoneProps","run_at_end_of_this_or_next_physical_tick","allSettled","possiblePromises","results","status","reason","AggregateError","failure","promise","shouldExecuteTick","beginMicroTickScope","propagateAllListeners","endMicroTickScope","_promise","origProp","addPossiblyUnhandledError","listeners","len","finalizePhysicalTick","listener","cb","callListener","ret","markErrorAsHandled","limit","errorName","prev","numPrev","wasRootExec","callbacks","unhandledErrs","finalizers","finalizer","some","wrap","errorCatcher","outerScope","switchToZone","task","awaits","echoes","taskCounter","zoneStack","zoneEchoes","zone_id_counter","props$$1","a1","a2","parent","globalEnv","PromiseProp","nthen","getPatchedPromiseThen","gthen","incrementExpectedAwaits","possiblePromise","rejection","zoneEnterEcho","targetZone","zoneLeaveEcho","pop","bEnteringZone","currentZone","enqueueNativeMicroTask","GlobalPromise_1","targetEnv","GlobalPromise","a3","job","outerZone","origThen","onResolved","UNHANDLEDREJECTION","event","eventData","createEvent","initEvent","CustomEvent","detail","dispatchEvent","PromiseRejectionEvent","onunhandledrejection","_","defaultPrevented","console","warn","tempTransaction","db","mode","storeNames","openComplete","letThrough","isBeingOpened","_options","autoOpen","open","dbReadyPromise","trans","_createTransaction","_dbSchema","_completion","DEXIE_VERSION","maxString","String","fromCharCode","minKey","INVALID_KEY_ARGUMENT","STRING_EXPECTED","connections","isIEOrEdge","navigator","userAgent","hasIEDeleteObjectStoreBug","hangsOnDeleteLargeKeyRange","dexieStackFrameFilter","DBNAMES_DB","READONLY","READWRITE","combine","filter1","filter2","AnyRange","lower","lowerOpen","upper","upperOpen","workaroundForUndefinedPrimKey","Table","_trans","writeLocked","_tx","tableName","checkTableInTransaction","schema","NotFound","idbtrans","transless","keyOrCrit","where","first","core","hook","reading","fire","indexOrCrit","WhereClause","keyPaths","equals","compoundIndex","indexes","primKey","ix","compound","every","_maxKey","JSON","stringify","idxByName","idb","_deps","indexedDB","cmp","prevIndex","prevFilterFn","index","multi","idx","filterFunction","toCollection","and","count","thenShortcut","offset","numRows","each","toArray","Collection","orderBy","reverse","mapToClass","mappedClass","readHook","unsubscribe","defineClass","Class","content","add","auto","objToAdd","mutate","numFailures","lastResult","update","keyOrObject","InvalidArgument","modify","put","delete","clear","range","bulkGet","keys$$1","getMany","bulkAdd","objects","keysOrOptions","wantResults","allKeys","numObjects","objectsToAdd","pos","bulkPut","objectsToPut","bulkDelete","numKeys","Events","ctx","evs","eventName","subscriber","subscribe","addEventType","chainFunction","defaultFunction","addConfiguredEvents","context","subscribers","cfg","fireEvent","makeClassConstructor","createTableConstructor","Table$$1","tableSchema","_allTables","isPlainKeyRange","ignoreLimitFilter","algorithm","or","justLimit","replayFilter","addFilter","addReplayFilter","factory","isLimitFilter","curr","addMatchFilter","isMatch","getIndexOrStore","coreSchema","isPrimKey","primaryKey","getIndexByKeyPath","Schema","openCursor","coreTable","keysOnly","dir","unique","query","iter","coreTrans","iterate","valueMapper","set_1","union","cursor","advance","stop","fail","_iterate","cursorPromise","mappedFn","c","wrappedFn","continue","advancer","_read","_ctx","error","table","_write","_addAlgorithm","clone","raw","Math","min","sortBy","parts","lastPart","lastIndex","getval","order","sorter","aVal","bVal","sort","valueMapper_1","a_1","offsetLeft","rowsLeft","until","bIncludeStopEntry","last","indexName","_ondirectionchange","desc","eachKey","eachUniqueKey","eachPrimaryKey","primaryKeys","uniqueKeys","firstKey","lastKey","distinct","strKey","found","changes","modifyer","anythingModified","outbound","extractKey","Dexie","totalFailures","applyMutateResult","expectedCount","_i","nextChunk","addValues","putValues","putKeys","deleteKeys","origValue","ctx_1","coreRange","createCollectionConstructor","Collection$$1","whereClause","keyRangeGenerator","keyRange","whereCtx","readingHook","simpleCompare","simpleCompareReverse","collectionOrWhereClause","T","collection","emptyCollection","rangeEqual","upperFactory","toUpperCase","toLowerCase","lowerFactory","nextCasing","lowerKey","upperNeedle","lowerNeedle","llp","lwrKeyChar","addIgnoreCaseAlgorithm","match","needles","suffix","compare","upperNeedles","lowerNeedles","direction","nextKeySuffix","needlesLen","initDirection","needleBounds","needle","nb","createRange","firstPossibleNeedle","lowestPossibleCasing","casing","enumerable","between","includeLower","includeUpper","_cmp","above","aboveOrEqual","below","belowOrEqual","startsWith","str","startsWithIgnoreCase","equalsIgnoreCase","anyOfIgnoreCase","startsWithAnyOfIgnoreCase","anyOf","_ascending","_descending","notEqual","inAnyRange","includeLowers","includeUppers","noneOf","ranges","ascending","descending","_min","max","_max","addRange","newRange","sortDirection","rangeSorter","rangePos","keyIsBeyondCurrentEntry","keyIsBeforeCurrentEntry","keyWithinCurrentRange","checkKey","startsWithAnyOf","createWhereClauseConstructor","WhereClause$$1","orCollection","MissingAPI","_IDBKeyRange","IDBKeyRange","safariMultiStoreFix","getMaxKey","IdbKeyRange","only","eventRejectHandler","preventDefault","target","stopPropagation","Transaction","_lock","_reculock","lockOwnerFor","_unlock","_blockedFuncs","_locked","fnAndPSD","shift","idbdb","dbOpenError","OpenFailed","active","transaction","ev","_reject","onabort","on","oncomplete","_resolve","bWriteLock","ReadOnly","_root","waitFor","promiseLike","root","_waitingFor","_waitingQueue","store","objectStore","spin","_spinCount","currentWaitPromise","abort","memoizedTables","_memoizedTables","transactionBoundTable","createTransactionConstructor","Transaction$$1","dbschema","complete","wasActive","createIndexSpec","src","nameFromKeyPath","createTableSchema","getKeyExtractor","getSinglePathKeyExtractor","getEffectiveKeys","req","getExistingValues","effectiveKeys","arrayify","_id_counter","getKeyPathAlias","createDBCore","tmpTrans","extractSchema","tables","objectStoreNames","autoIncrement","indexByKeyPath","isPrimaryKey","indexNames","multiEntry","hasGetAll","makeIDBKeyRange","idbRange","upperBound","lowerBound","bound","createDbCoreTable","isAddOrPut","errorHandler","_reqno","setResult","args1","args2","source","openKeyCursor","___id","_cursorContinue","_cursorContinuePrimaryKey","continuePrimaryKey","_cursorAdvance","doThrowCursorIsNotStarted","doThrowCursorIsStopped","gotOne","iterationPromise","resolveIteration","rejectIteration","guardedCallback","request","nonInfinitLimit","idbKeyRange","getAll","getAllKeys","count_1","req_1","result_1","keyCount","callbackCount","valueCount","successHandler","_pos","tableMap","MIN_KEY","MAX_KEY","createMiddlewareStack","stackImpl","middlewares","down","createMiddlewareStacks","dbcore","generateMiddlewareStacks","_middlewares","tbl","setApiOnPlace","objs","tableNames","propDesc","removeTablesApi","lowerVersionFirst","_cfg","version","runUpgraders","oldVersion","idbUpgradeTrans","globalSchema","_storeNames","rejectTransaction","createTable","populate","updateTablesAndIndexes","queue","versions","_versions","buildGlobalSchema","anyContentUpgraderHasRun","versToRun","oldSchema","newSchema","adjustToExistingIndexNames","diff","getSchemaDiff","tuple","change","recreate","Upgrade","store_1","addIndex","deleteIndex","del","idxName","contentUpgrade","upgradeSchema_1","contentUpgradeIsAsync_1","returnValue_1","promiseFollowed","decrementor","deleteRemovedTables","runQueue","createMissingTables","oldDef","newDef","def","oldIndexes","newIndexes","oldIdx","newIdx","createObjectStore","contains","storeName","deleteObjectStore","createIndex","dbStoreNames","idbindex","readGlobalSchema","verno","verifyInstalledSchema","installedSchema","ch","_hasGetAll","dexieName","indexSpec","WorkerGlobalScope","parseIndexSyntax","primKeyAndIndexes","indexNum","trim","replace","Version","_parseStoresSpec","stores","outSchema","storesSource","storesSpec","upgrade","upgradeFunction","createVersionConstructor","Version$$1","versionNumber","databaseEnumerator","DatabaseEnumerator","hasDatabasesNative","databases","dbNamesTable","addons","dbnames","getDatabaseNames","infos","info","remove","initDatabaseEnumerator","vip","dexieOpen","state","openCanceller","resolveDbReady","dbReadyResolve","upgradeTransaction","dbName","autoSchema","round","onblocked","_fireOnBlocked","onupgradeneeded","allowEmptyDB","close","delreq","deleteDatabase","NoSuchDatabase","oldVer","pow","onversionchange","vcFired","onReadyBeingFired","ready","fireRemainders","remainders","awaitIterator","callNext","doThrow","throw","onSuccess","step","onError","getNext","extractTransactionArgs","_tableArgs_","scopeFunc","enterTransactionScope","parentTransaction","scopeFuncIsAsync","returnValue","PrematureCommit","pad","createVirtualIndexMiddleware","indexLookup","allVirtualIndexes","addVirtualIndexes","keyTail","lowLevelIndex","keyPathAlias","indexList","keyLength","isVirtual","virtualIndex","virtualKeyPath","findBestIndex","translateRange","translateRequest","createVirtualCursor","_continue","virtualCursor","virtualIndexMiddleware","level","hooksMiddleware","downCore","downTable","tableMiddleware","dxTrans","deleting","creating","updating","addPutOrDelete","deleteRange","existingValues","contexts","existingValue","generatedPrimaryKey","objectDiff","additionalChanges_1","requestedValue_1","deleteNextChunk","deps","dependencies","cancelOpen","bSticky","db_1","newVersion","use","addon","versionInstance","_whenReady","unuse","mw","hasArguments","doDelete","backendDB","isOpen","hasBeenClosed","hasFailed","dynamicallyOpened","_transaction","onlyIfCompatible","idbMode","SubTransaction","enterTransaction","InvalidTable","Dexie$1","databaseName","exists","ignoreTransaction","async","generatorFn","spawn","currentTransaction","promiseOrFunction","optionalTimeout","mozIndexedDB","webkitIndexedDB","msIndexedDB","webkitIDBKeyRange","semVer","default","maxKey"],"mappings":"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","file":"3627.f8c5d40a3bfc7ed1adad.js","sourcesContent":["/*\n * Dexie.js - a minimalistic wrapper for IndexedDB\n * ===============================================\n *\n * By David Fahlander, david.fahlander@gmail.com\n *\n * Version 3.0.3, Wed Nov 18 2020\n *\n * http://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n */\n \nvar __assign = function() {\n    __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n\n\n\n\n\n\n\n\n\n\nfunction __spreadArrays() {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n}\n\nvar keys = Object.keys;\nvar isArray = Array.isArray;\nvar _global = typeof self !== 'undefined' ? self :\n    typeof window !== 'undefined' ? window :\n        global;\nif (typeof Promise !== 'undefined' && !_global.Promise) {\n    _global.Promise = Promise;\n}\nfunction extend(obj, extension) {\n    if (typeof extension !== 'object')\n        return obj;\n    keys(extension).forEach(function (key) {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\nvar getProto = Object.getPrototypeOf;\nvar _hasOwn = {}.hasOwnProperty;\nfunction hasOwn(obj, prop) {\n    return _hasOwn.call(obj, prop);\n}\nfunction props(proto, extension) {\n    if (typeof extension === 'function')\n        extension = extension(getProto(proto));\n    keys(extension).forEach(function (key) {\n        setProp(proto, key, extension[key]);\n    });\n}\nvar defineProperty = Object.defineProperty;\nfunction setProp(obj, prop, functionOrGetSet, options) {\n    defineProperty(obj, prop, extend(functionOrGetSet && hasOwn(functionOrGetSet, \"get\") && typeof functionOrGetSet.get === 'function' ?\n        { get: functionOrGetSet.get, set: functionOrGetSet.set, configurable: true } :\n        { value: functionOrGetSet, configurable: true, writable: true }, options));\n}\nfunction derive(Child) {\n    return {\n        from: function (Parent) {\n            Child.prototype = Object.create(Parent.prototype);\n            setProp(Child.prototype, \"constructor\", Child);\n            return {\n                extend: props.bind(null, Child.prototype)\n            };\n        }\n    };\n}\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nfunction getPropertyDescriptor(obj, prop) {\n    var pd = getOwnPropertyDescriptor(obj, prop);\n    var proto;\n    return pd || (proto = getProto(obj)) && getPropertyDescriptor(proto, prop);\n}\nvar _slice = [].slice;\nfunction slice(args, start, end) {\n    return _slice.call(args, start, end);\n}\nfunction override(origFunc, overridedFactory) {\n    return overridedFactory(origFunc);\n}\nfunction assert(b) {\n    if (!b)\n        throw new Error(\"Assertion Failed\");\n}\nfunction asap(fn) {\n    if (_global.setImmediate)\n        setImmediate(fn);\n    else\n        setTimeout(fn, 0);\n}\n\nfunction arrayToObject(array, extractor) {\n    return array.reduce(function (result, item, i) {\n        var nameAndValue = extractor(item, i);\n        if (nameAndValue)\n            result[nameAndValue[0]] = nameAndValue[1];\n        return result;\n    }, {});\n}\n\nfunction tryCatch(fn, onerror, args) {\n    try {\n        fn.apply(null, args);\n    }\n    catch (ex) {\n        onerror && onerror(ex);\n    }\n}\nfunction getByKeyPath(obj, keyPath) {\n    if (hasOwn(obj, keyPath))\n        return obj[keyPath];\n    if (!keyPath)\n        return obj;\n    if (typeof keyPath !== 'string') {\n        var rv = [];\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            var val = getByKeyPath(obj, keyPath[i]);\n            rv.push(val);\n        }\n        return rv;\n    }\n    var period = keyPath.indexOf('.');\n    if (period !== -1) {\n        var innerObj = obj[keyPath.substr(0, period)];\n        return innerObj === undefined ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n    }\n    return undefined;\n}\nfunction setByKeyPath(obj, keyPath, value) {\n    if (!obj || keyPath === undefined)\n        return;\n    if ('isFrozen' in Object && Object.isFrozen(obj))\n        return;\n    if (typeof keyPath !== 'string' && 'length' in keyPath) {\n        assert(typeof value !== 'string' && 'length' in value);\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            setByKeyPath(obj, keyPath[i], value[i]);\n        }\n    }\n    else {\n        var period = keyPath.indexOf('.');\n        if (period !== -1) {\n            var currentKeyPath = keyPath.substr(0, period);\n            var remainingKeyPath = keyPath.substr(period + 1);\n            if (remainingKeyPath === \"\")\n                if (value === undefined) {\n                    if (isArray(obj) && !isNaN(parseInt(currentKeyPath)))\n                        obj.splice(currentKeyPath, 1);\n                    else\n                        delete obj[currentKeyPath];\n                }\n                else\n                    obj[currentKeyPath] = value;\n            else {\n                var innerObj = obj[currentKeyPath];\n                if (!innerObj)\n                    innerObj = (obj[currentKeyPath] = {});\n                setByKeyPath(innerObj, remainingKeyPath, value);\n            }\n        }\n        else {\n            if (value === undefined) {\n                if (isArray(obj) && !isNaN(parseInt(keyPath)))\n                    obj.splice(keyPath, 1);\n                else\n                    delete obj[keyPath];\n            }\n            else\n                obj[keyPath] = value;\n        }\n    }\n}\nfunction delByKeyPath(obj, keyPath) {\n    if (typeof keyPath === 'string')\n        setByKeyPath(obj, keyPath, undefined);\n    else if ('length' in keyPath)\n        [].map.call(keyPath, function (kp) {\n            setByKeyPath(obj, kp, undefined);\n        });\n}\nfunction shallowClone(obj) {\n    var rv = {};\n    for (var m in obj) {\n        if (hasOwn(obj, m))\n            rv[m] = obj[m];\n    }\n    return rv;\n}\nvar concat = [].concat;\nfunction flatten(a) {\n    return concat.apply([], a);\n}\nvar intrinsicTypeNames = \"Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set\"\n    .split(',').concat(flatten([8, 16, 32, 64].map(function (num) { return [\"Int\", \"Uint\", \"Float\"].map(function (t) { return t + num + \"Array\"; }); }))).filter(function (t) { return _global[t]; });\nvar intrinsicTypes = intrinsicTypeNames.map(function (t) { return _global[t]; });\nvar intrinsicTypeNameSet = arrayToObject(intrinsicTypeNames, function (x) { return [x, true]; });\nfunction deepClone(any) {\n    if (!any || typeof any !== 'object')\n        return any;\n    var rv;\n    if (isArray(any)) {\n        rv = [];\n        for (var i = 0, l = any.length; i < l; ++i) {\n            rv.push(deepClone(any[i]));\n        }\n    }\n    else if (intrinsicTypes.indexOf(any.constructor) >= 0) {\n        rv = any;\n    }\n    else {\n        rv = any.constructor ? Object.create(any.constructor.prototype) : {};\n        for (var prop in any) {\n            if (hasOwn(any, prop)) {\n                rv[prop] = deepClone(any[prop]);\n            }\n        }\n    }\n    return rv;\n}\nvar toString = {}.toString;\nfunction toStringTag(o) {\n    return toString.call(o).slice(8, -1);\n}\nvar getValueOf = function (val, type) {\n    return type === \"Array\" ? '' + val.map(function (v) { return getValueOf(v, toStringTag(v)); }) :\n        type === \"ArrayBuffer\" ? '' + new Uint8Array(val) :\n            type === \"Date\" ? val.getTime() :\n                ArrayBuffer.isView(val) ? '' + new Uint8Array(val.buffer) :\n                    val;\n};\nfunction getObjectDiff(a, b, rv, prfx) {\n    rv = rv || {};\n    prfx = prfx || '';\n    keys(a).forEach(function (prop) {\n        if (!hasOwn(b, prop))\n            rv[prfx + prop] = undefined;\n        else {\n            var ap = a[prop], bp = b[prop];\n            if (typeof ap === 'object' && typeof bp === 'object' && ap && bp) {\n                var apTypeName = toStringTag(ap);\n                var bpTypeName = toStringTag(bp);\n                if (apTypeName === bpTypeName) {\n                    if (intrinsicTypeNameSet[apTypeName]) {\n                        if (getValueOf(ap, apTypeName) !== getValueOf(bp, bpTypeName)) {\n                            rv[prfx + prop] = b[prop];\n                        }\n                    }\n                    else {\n                        getObjectDiff(ap, bp, rv, prfx + prop + \".\");\n                    }\n                }\n                else {\n                    rv[prfx + prop] = b[prop];\n                }\n            }\n            else if (ap !== bp)\n                rv[prfx + prop] = b[prop];\n        }\n    });\n    keys(b).forEach(function (prop) {\n        if (!hasOwn(a, prop)) {\n            rv[prfx + prop] = b[prop];\n        }\n    });\n    return rv;\n}\nvar iteratorSymbol = typeof Symbol !== 'undefined' && Symbol.iterator;\nvar getIteratorOf = iteratorSymbol ? function (x) {\n    var i;\n    return x != null && (i = x[iteratorSymbol]) && i.apply(x);\n} : function () { return null; };\nvar NO_CHAR_ARRAY = {};\nfunction getArrayOf(arrayLike) {\n    var i, a, x, it;\n    if (arguments.length === 1) {\n        if (isArray(arrayLike))\n            return arrayLike.slice();\n        if (this === NO_CHAR_ARRAY && typeof arrayLike === 'string')\n            return [arrayLike];\n        if ((it = getIteratorOf(arrayLike))) {\n            a = [];\n            while (x = it.next(), !x.done)\n                a.push(x.value);\n            return a;\n        }\n        if (arrayLike == null)\n            return [arrayLike];\n        i = arrayLike.length;\n        if (typeof i === 'number') {\n            a = new Array(i);\n            while (i--)\n                a[i] = arrayLike[i];\n            return a;\n        }\n        return [arrayLike];\n    }\n    i = arguments.length;\n    a = new Array(i);\n    while (i--)\n        a[i] = arguments[i];\n    return a;\n}\nvar isAsyncFunction = typeof Symbol !== 'undefined'\n    ? function (fn) { return fn[Symbol.toStringTag] === 'AsyncFunction'; }\n    : function () { return false; };\n\nvar debug = typeof location !== 'undefined' &&\n    /^(http|https):\\/\\/(localhost|127\\.0\\.0\\.1)/.test(location.href);\nfunction setDebug(value, filter) {\n    debug = value;\n    libraryFilter = filter;\n}\nvar libraryFilter = function () { return true; };\nvar NEEDS_THROW_FOR_STACK = !new Error(\"\").stack;\nfunction getErrorWithStack() {\n    if (NEEDS_THROW_FOR_STACK)\n        try {\n            throw new Error();\n        }\n        catch (e) {\n            return e;\n        }\n    return new Error();\n}\nfunction prettyStack(exception, numIgnoredFrames) {\n    var stack = exception.stack;\n    if (!stack)\n        return \"\";\n    numIgnoredFrames = (numIgnoredFrames || 0);\n    if (stack.indexOf(exception.name) === 0)\n        numIgnoredFrames += (exception.name + exception.message).split('\\n').length;\n    return stack.split('\\n')\n        .slice(numIgnoredFrames)\n        .filter(libraryFilter)\n        .map(function (frame) { return \"\\n\" + frame; })\n        .join('');\n}\n\nvar dexieErrorNames = [\n    'Modify',\n    'Bulk',\n    'OpenFailed',\n    'VersionChange',\n    'Schema',\n    'Upgrade',\n    'InvalidTable',\n    'MissingAPI',\n    'NoSuchDatabase',\n    'InvalidArgument',\n    'SubTransaction',\n    'Unsupported',\n    'Internal',\n    'DatabaseClosed',\n    'PrematureCommit',\n    'ForeignAwait'\n];\nvar idbDomErrorNames = [\n    'Unknown',\n    'Constraint',\n    'Data',\n    'TransactionInactive',\n    'ReadOnly',\n    'Version',\n    'NotFound',\n    'InvalidState',\n    'InvalidAccess',\n    'Abort',\n    'Timeout',\n    'QuotaExceeded',\n    'Syntax',\n    'DataClone'\n];\nvar errorList = dexieErrorNames.concat(idbDomErrorNames);\nvar defaultTexts = {\n    VersionChanged: \"Database version changed by other database connection\",\n    DatabaseClosed: \"Database has been closed\",\n    Abort: \"Transaction aborted\",\n    TransactionInactive: \"Transaction has already completed or failed\"\n};\nfunction DexieError(name, msg) {\n    this._e = getErrorWithStack();\n    this.name = name;\n    this.message = msg;\n}\nderive(DexieError).from(Error).extend({\n    stack: {\n        get: function () {\n            return this._stack ||\n                (this._stack = this.name + \": \" + this.message + prettyStack(this._e, 2));\n        }\n    },\n    toString: function () { return this.name + \": \" + this.message; }\n});\nfunction getMultiErrorMessage(msg, failures) {\n    return msg + \". Errors: \" + Object.keys(failures)\n        .map(function (key) { return failures[key].toString(); })\n        .filter(function (v, i, s) { return s.indexOf(v) === i; })\n        .join('\\n');\n}\nfunction ModifyError(msg, failures, successCount, failedKeys) {\n    this._e = getErrorWithStack();\n    this.failures = failures;\n    this.failedKeys = failedKeys;\n    this.successCount = successCount;\n    this.message = getMultiErrorMessage(msg, failures);\n}\nderive(ModifyError).from(DexieError);\nfunction BulkError(msg, failures) {\n    this._e = getErrorWithStack();\n    this.name = \"BulkError\";\n    this.failures = failures;\n    this.message = getMultiErrorMessage(msg, failures);\n}\nderive(BulkError).from(DexieError);\nvar errnames = errorList.reduce(function (obj, name) { return (obj[name] = name + \"Error\", obj); }, {});\nvar BaseException = DexieError;\nvar exceptions = errorList.reduce(function (obj, name) {\n    var fullName = name + \"Error\";\n    function DexieError(msgOrInner, inner) {\n        this._e = getErrorWithStack();\n        this.name = fullName;\n        if (!msgOrInner) {\n            this.message = defaultTexts[name] || fullName;\n            this.inner = null;\n        }\n        else if (typeof msgOrInner === 'string') {\n            this.message = \"\" + msgOrInner + (!inner ? '' : '\\n ' + inner);\n            this.inner = inner || null;\n        }\n        else if (typeof msgOrInner === 'object') {\n            this.message = msgOrInner.name + \" \" + msgOrInner.message;\n            this.inner = msgOrInner;\n        }\n    }\n    derive(DexieError).from(BaseException);\n    obj[name] = DexieError;\n    return obj;\n}, {});\nexceptions.Syntax = SyntaxError;\nexceptions.Type = TypeError;\nexceptions.Range = RangeError;\nvar exceptionMap = idbDomErrorNames.reduce(function (obj, name) {\n    obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfunction mapError(domError, message) {\n    if (!domError || domError instanceof DexieError || domError instanceof TypeError || domError instanceof SyntaxError || !domError.name || !exceptionMap[domError.name])\n        return domError;\n    var rv = new exceptionMap[domError.name](message || domError.message, domError);\n    if (\"stack\" in domError) {\n        setProp(rv, \"stack\", { get: function () {\n                return this.inner.stack;\n            } });\n    }\n    return rv;\n}\nvar fullNameExceptions = errorList.reduce(function (obj, name) {\n    if ([\"Syntax\", \"Type\", \"Range\"].indexOf(name) === -1)\n        obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfullNameExceptions.ModifyError = ModifyError;\nfullNameExceptions.DexieError = DexieError;\nfullNameExceptions.BulkError = BulkError;\n\nfunction nop() { }\nfunction mirror(val) { return val; }\nfunction pureFunctionChain(f1, f2) {\n    if (f1 == null || f1 === mirror)\n        return f2;\n    return function (val) {\n        return f2(f1(val));\n    };\n}\nfunction callBoth(on1, on2) {\n    return function () {\n        on1.apply(this, arguments);\n        on2.apply(this, arguments);\n    };\n}\nfunction hookCreatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res !== undefined)\n            arguments[0] = res;\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res2 !== undefined ? res2 : res;\n    };\n}\nfunction hookDeletingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        f1.apply(this, arguments);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = this.onerror = null;\n        f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n    };\n}\nfunction hookUpdatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function (modifications) {\n        var res = f1.apply(this, arguments);\n        extend(modifications, res);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res === undefined ?\n            (res2 === undefined ? undefined : res2) :\n            (extend(res, res2));\n    };\n}\nfunction reverseStoppableEventChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        if (f2.apply(this, arguments) === false)\n            return false;\n        return f1.apply(this, arguments);\n    };\n}\n\nfunction promisableChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res && typeof res.then === 'function') {\n            var thiz = this, i = arguments.length, args = new Array(i);\n            while (i--)\n                args[i] = arguments[i];\n            return res.then(function () {\n                return f2.apply(thiz, args);\n            });\n        }\n        return f2.apply(this, arguments);\n    };\n}\n\nvar INTERNAL = {};\nvar LONG_STACKS_CLIP_LIMIT = 100;\nvar MAX_LONG_STACKS = 20;\nvar ZONE_ECHO_LIMIT = 100;\nvar _a = typeof Promise === 'undefined' ?\n    [] :\n    (function () {\n        var globalP = Promise.resolve();\n        if (typeof crypto === 'undefined' || !crypto.subtle)\n            return [globalP, globalP.__proto__, globalP];\n        var nativeP = crypto.subtle.digest(\"SHA-512\", new Uint8Array([0]));\n        return [\n            nativeP,\n            nativeP.__proto__,\n            globalP\n        ];\n    })();\nvar resolvedNativePromise = _a[0];\nvar nativePromiseProto = _a[1];\nvar resolvedGlobalPromise = _a[2];\nvar nativePromiseThen = nativePromiseProto && nativePromiseProto.then;\nvar NativePromise = resolvedNativePromise && resolvedNativePromise.constructor;\nvar patchGlobalPromise = !!resolvedGlobalPromise;\nvar stack_being_generated = false;\nvar schedulePhysicalTick = resolvedGlobalPromise ?\n    function () { resolvedGlobalPromise.then(physicalTick); }\n    :\n        _global.setImmediate ?\n            setImmediate.bind(null, physicalTick) :\n            _global.MutationObserver ?\n                function () {\n                    var hiddenDiv = document.createElement(\"div\");\n                    (new MutationObserver(function () {\n                        physicalTick();\n                        hiddenDiv = null;\n                    })).observe(hiddenDiv, { attributes: true });\n                    hiddenDiv.setAttribute('i', '1');\n                } :\n                function () { setTimeout(physicalTick, 0); };\nvar asap$1 = function (callback, args) {\n    microtickQueue.push([callback, args]);\n    if (needsNewPhysicalTick) {\n        schedulePhysicalTick();\n        needsNewPhysicalTick = false;\n    }\n};\nvar isOutsideMicroTick = true;\nvar needsNewPhysicalTick = true;\nvar unhandledErrors = [];\nvar rejectingErrors = [];\nvar currentFulfiller = null;\nvar rejectionMapper = mirror;\nvar globalPSD = {\n    id: 'global',\n    global: true,\n    ref: 0,\n    unhandleds: [],\n    onunhandled: globalError,\n    pgp: false,\n    env: {},\n    finalize: function () {\n        this.unhandleds.forEach(function (uh) {\n            try {\n                globalError(uh[0], uh[1]);\n            }\n            catch (e) { }\n        });\n    }\n};\nvar PSD = globalPSD;\nvar microtickQueue = [];\nvar numScheduledCalls = 0;\nvar tickFinalizers = [];\nfunction DexiePromise(fn) {\n    if (typeof this !== 'object')\n        throw new TypeError('Promises must be constructed via new');\n    this._listeners = [];\n    this.onuncatched = nop;\n    this._lib = false;\n    var psd = (this._PSD = PSD);\n    if (debug) {\n        this._stackHolder = getErrorWithStack();\n        this._prev = null;\n        this._numPrev = 0;\n    }\n    if (typeof fn !== 'function') {\n        if (fn !== INTERNAL)\n            throw new TypeError('Not a function');\n        this._state = arguments[1];\n        this._value = arguments[2];\n        if (this._state === false)\n            handleRejection(this, this._value);\n        return;\n    }\n    this._state = null;\n    this._value = null;\n    ++psd.ref;\n    executePromiseTask(this, fn);\n}\nvar thenProp = {\n    get: function () {\n        var psd = PSD, microTaskId = totalEchoes;\n        function then(onFulfilled, onRejected) {\n            var _this = this;\n            var possibleAwait = !psd.global && (psd !== PSD || microTaskId !== totalEchoes);\n            var cleanup = possibleAwait && !decrementExpectedAwaits();\n            var rv = new DexiePromise(function (resolve, reject) {\n                propagateToListener(_this, new Listener(nativeAwaitCompatibleWrap(onFulfilled, psd, possibleAwait, cleanup), nativeAwaitCompatibleWrap(onRejected, psd, possibleAwait, cleanup), resolve, reject, psd));\n            });\n            debug && linkToPreviousPromise(rv, this);\n            return rv;\n        }\n        then.prototype = INTERNAL;\n        return then;\n    },\n    set: function (value) {\n        setProp(this, 'then', value && value.prototype === INTERNAL ?\n            thenProp :\n            {\n                get: function () {\n                    return value;\n                },\n                set: thenProp.set\n            });\n    }\n};\nprops(DexiePromise.prototype, {\n    then: thenProp,\n    _then: function (onFulfilled, onRejected) {\n        propagateToListener(this, new Listener(null, null, onFulfilled, onRejected, PSD));\n    },\n    catch: function (onRejected) {\n        if (arguments.length === 1)\n            return this.then(null, onRejected);\n        var type = arguments[0], handler = arguments[1];\n        return typeof type === 'function' ? this.then(null, function (err) {\n            return err instanceof type ? handler(err) : PromiseReject(err);\n        })\n            : this.then(null, function (err) {\n                return err && err.name === type ? handler(err) : PromiseReject(err);\n            });\n    },\n    finally: function (onFinally) {\n        return this.then(function (value) {\n            onFinally();\n            return value;\n        }, function (err) {\n            onFinally();\n            return PromiseReject(err);\n        });\n    },\n    stack: {\n        get: function () {\n            if (this._stack)\n                return this._stack;\n            try {\n                stack_being_generated = true;\n                var stacks = getStack(this, [], MAX_LONG_STACKS);\n                var stack = stacks.join(\"\\nFrom previous: \");\n                if (this._state !== null)\n                    this._stack = stack;\n                return stack;\n            }\n            finally {\n                stack_being_generated = false;\n            }\n        }\n    },\n    timeout: function (ms, msg) {\n        var _this = this;\n        return ms < Infinity ?\n            new DexiePromise(function (resolve, reject) {\n                var handle = setTimeout(function () { return reject(new exceptions.Timeout(msg)); }, ms);\n                _this.then(resolve, reject).finally(clearTimeout.bind(null, handle));\n            }) : this;\n    }\n});\nif (typeof Symbol !== 'undefined' && Symbol.toStringTag)\n    setProp(DexiePromise.prototype, Symbol.toStringTag, 'Dexie.Promise');\nglobalPSD.env = snapShot();\nfunction Listener(onFulfilled, onRejected, resolve, reject, zone) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.resolve = resolve;\n    this.reject = reject;\n    this.psd = zone;\n}\nprops(DexiePromise, {\n    all: function () {\n        var values = getArrayOf.apply(null, arguments)\n            .map(onPossibleParallellAsync);\n        return new DexiePromise(function (resolve, reject) {\n            if (values.length === 0)\n                resolve([]);\n            var remaining = values.length;\n            values.forEach(function (a, i) { return DexiePromise.resolve(a).then(function (x) {\n                values[i] = x;\n                if (!--remaining)\n                    resolve(values);\n            }, reject); });\n        });\n    },\n    resolve: function (value) {\n        if (value instanceof DexiePromise)\n            return value;\n        if (value && typeof value.then === 'function')\n            return new DexiePromise(function (resolve, reject) {\n                value.then(resolve, reject);\n            });\n        var rv = new DexiePromise(INTERNAL, true, value);\n        linkToPreviousPromise(rv, currentFulfiller);\n        return rv;\n    },\n    reject: PromiseReject,\n    race: function () {\n        var values = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n        return new DexiePromise(function (resolve, reject) {\n            values.map(function (value) { return DexiePromise.resolve(value).then(resolve, reject); });\n        });\n    },\n    PSD: {\n        get: function () { return PSD; },\n        set: function (value) { return PSD = value; }\n    },\n    totalEchoes: { get: function () { return totalEchoes; } },\n    newPSD: newScope,\n    usePSD: usePSD,\n    scheduler: {\n        get: function () { return asap$1; },\n        set: function (value) { asap$1 = value; }\n    },\n    rejectionMapper: {\n        get: function () { return rejectionMapper; },\n        set: function (value) { rejectionMapper = value; }\n    },\n    follow: function (fn, zoneProps) {\n        return new DexiePromise(function (resolve, reject) {\n            return newScope(function (resolve, reject) {\n                var psd = PSD;\n                psd.unhandleds = [];\n                psd.onunhandled = reject;\n                psd.finalize = callBoth(function () {\n                    var _this = this;\n                    run_at_end_of_this_or_next_physical_tick(function () {\n                        _this.unhandleds.length === 0 ? resolve() : reject(_this.unhandleds[0]);\n                    });\n                }, psd.finalize);\n                fn();\n            }, zoneProps, resolve, reject);\n        });\n    }\n});\nif (NativePromise) {\n    if (NativePromise.allSettled)\n        setProp(DexiePromise, \"allSettled\", function () {\n            var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve) {\n                if (possiblePromises.length === 0)\n                    resolve([]);\n                var remaining = possiblePromises.length;\n                var results = new Array(remaining);\n                possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return results[i] = { status: \"fulfilled\", value: value }; }, function (reason) { return results[i] = { status: \"rejected\", reason: reason }; })\n                    .then(function () { return --remaining || resolve(results); }); });\n            });\n        });\n    if (NativePromise.any && typeof AggregateError !== 'undefined')\n        setProp(DexiePromise, \"any\", function () {\n            var possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(function (resolve, reject) {\n                if (possiblePromises.length === 0)\n                    reject(new AggregateError([]));\n                var remaining = possiblePromises.length;\n                var failures = new Array(remaining);\n                possiblePromises.forEach(function (p, i) { return DexiePromise.resolve(p).then(function (value) { return resolve(value); }, function (failure) {\n                    failures[i] = failure;\n                    if (!--remaining)\n                        reject(new AggregateError(failures));\n                }); });\n            });\n        });\n}\nfunction executePromiseTask(promise, fn) {\n    try {\n        fn(function (value) {\n            if (promise._state !== null)\n                return;\n            if (value === promise)\n                throw new TypeError('A promise cannot be resolved with itself.');\n            var shouldExecuteTick = promise._lib && beginMicroTickScope();\n            if (value && typeof value.then === 'function') {\n                executePromiseTask(promise, function (resolve, reject) {\n                    value instanceof DexiePromise ?\n                        value._then(resolve, reject) :\n                        value.then(resolve, reject);\n                });\n            }\n            else {\n                promise._state = true;\n                promise._value = value;\n                propagateAllListeners(promise);\n            }\n            if (shouldExecuteTick)\n                endMicroTickScope();\n        }, handleRejection.bind(null, promise));\n    }\n    catch (ex) {\n        handleRejection(promise, ex);\n    }\n}\nfunction handleRejection(promise, reason) {\n    rejectingErrors.push(reason);\n    if (promise._state !== null)\n        return;\n    var shouldExecuteTick = promise._lib && beginMicroTickScope();\n    reason = rejectionMapper(reason);\n    promise._state = false;\n    promise._value = reason;\n    debug && reason !== null && typeof reason === 'object' && !reason._promise && tryCatch(function () {\n        var origProp = getPropertyDescriptor(reason, \"stack\");\n        reason._promise = promise;\n        setProp(reason, \"stack\", {\n            get: function () {\n                return stack_being_generated ?\n                    origProp && (origProp.get ?\n                        origProp.get.apply(reason) :\n                        origProp.value) :\n                    promise.stack;\n            }\n        });\n    });\n    addPossiblyUnhandledError(promise);\n    propagateAllListeners(promise);\n    if (shouldExecuteTick)\n        endMicroTickScope();\n}\nfunction propagateAllListeners(promise) {\n    var listeners = promise._listeners;\n    promise._listeners = [];\n    for (var i = 0, len = listeners.length; i < len; ++i) {\n        propagateToListener(promise, listeners[i]);\n    }\n    var psd = promise._PSD;\n    --psd.ref || psd.finalize();\n    if (numScheduledCalls === 0) {\n        ++numScheduledCalls;\n        asap$1(function () {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n        }, []);\n    }\n}\nfunction propagateToListener(promise, listener) {\n    if (promise._state === null) {\n        promise._listeners.push(listener);\n        return;\n    }\n    var cb = promise._state ? listener.onFulfilled : listener.onRejected;\n    if (cb === null) {\n        return (promise._state ? listener.resolve : listener.reject)(promise._value);\n    }\n    ++listener.psd.ref;\n    ++numScheduledCalls;\n    asap$1(callListener, [cb, promise, listener]);\n}\nfunction callListener(cb, promise, listener) {\n    try {\n        currentFulfiller = promise;\n        var ret, value = promise._value;\n        if (promise._state) {\n            ret = cb(value);\n        }\n        else {\n            if (rejectingErrors.length)\n                rejectingErrors = [];\n            ret = cb(value);\n            if (rejectingErrors.indexOf(value) === -1)\n                markErrorAsHandled(promise);\n        }\n        listener.resolve(ret);\n    }\n    catch (e) {\n        listener.reject(e);\n    }\n    finally {\n        currentFulfiller = null;\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n        --listener.psd.ref || listener.psd.finalize();\n    }\n}\nfunction getStack(promise, stacks, limit) {\n    if (stacks.length === limit)\n        return stacks;\n    var stack = \"\";\n    if (promise._state === false) {\n        var failure = promise._value, errorName, message;\n        if (failure != null) {\n            errorName = failure.name || \"Error\";\n            message = failure.message || failure;\n            stack = prettyStack(failure, 0);\n        }\n        else {\n            errorName = failure;\n            message = \"\";\n        }\n        stacks.push(errorName + (message ? \": \" + message : \"\") + stack);\n    }\n    if (debug) {\n        stack = prettyStack(promise._stackHolder, 2);\n        if (stack && stacks.indexOf(stack) === -1)\n            stacks.push(stack);\n        if (promise._prev)\n            getStack(promise._prev, stacks, limit);\n    }\n    return stacks;\n}\nfunction linkToPreviousPromise(promise, prev) {\n    var numPrev = prev ? prev._numPrev + 1 : 0;\n    if (numPrev < LONG_STACKS_CLIP_LIMIT) {\n        promise._prev = prev;\n        promise._numPrev = numPrev;\n    }\n}\nfunction physicalTick() {\n    beginMicroTickScope() && endMicroTickScope();\n}\nfunction beginMicroTickScope() {\n    var wasRootExec = isOutsideMicroTick;\n    isOutsideMicroTick = false;\n    needsNewPhysicalTick = false;\n    return wasRootExec;\n}\nfunction endMicroTickScope() {\n    var callbacks, i, l;\n    do {\n        while (microtickQueue.length > 0) {\n            callbacks = microtickQueue;\n            microtickQueue = [];\n            l = callbacks.length;\n            for (i = 0; i < l; ++i) {\n                var item = callbacks[i];\n                item[0].apply(null, item[1]);\n            }\n        }\n    } while (microtickQueue.length > 0);\n    isOutsideMicroTick = true;\n    needsNewPhysicalTick = true;\n}\nfunction finalizePhysicalTick() {\n    var unhandledErrs = unhandledErrors;\n    unhandledErrors = [];\n    unhandledErrs.forEach(function (p) {\n        p._PSD.onunhandled.call(null, p._value, p);\n    });\n    var finalizers = tickFinalizers.slice(0);\n    var i = finalizers.length;\n    while (i)\n        finalizers[--i]();\n}\nfunction run_at_end_of_this_or_next_physical_tick(fn) {\n    function finalizer() {\n        fn();\n        tickFinalizers.splice(tickFinalizers.indexOf(finalizer), 1);\n    }\n    tickFinalizers.push(finalizer);\n    ++numScheduledCalls;\n    asap$1(function () {\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n    }, []);\n}\nfunction addPossiblyUnhandledError(promise) {\n    if (!unhandledErrors.some(function (p) { return p._value === promise._value; }))\n        unhandledErrors.push(promise);\n}\nfunction markErrorAsHandled(promise) {\n    var i = unhandledErrors.length;\n    while (i)\n        if (unhandledErrors[--i]._value === promise._value) {\n            unhandledErrors.splice(i, 1);\n            return;\n        }\n}\nfunction PromiseReject(reason) {\n    return new DexiePromise(INTERNAL, false, reason);\n}\nfunction wrap(fn, errorCatcher) {\n    var psd = PSD;\n    return function () {\n        var wasRootExec = beginMicroTickScope(), outerScope = PSD;\n        try {\n            switchToZone(psd, true);\n            return fn.apply(this, arguments);\n        }\n        catch (e) {\n            errorCatcher && errorCatcher(e);\n        }\n        finally {\n            switchToZone(outerScope, false);\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    };\n}\nvar task = { awaits: 0, echoes: 0, id: 0 };\nvar taskCounter = 0;\nvar zoneStack = [];\nvar zoneEchoes = 0;\nvar totalEchoes = 0;\nvar zone_id_counter = 0;\nfunction newScope(fn, props$$1, a1, a2) {\n    var parent = PSD, psd = Object.create(parent);\n    psd.parent = parent;\n    psd.ref = 0;\n    psd.global = false;\n    psd.id = ++zone_id_counter;\n    var globalEnv = globalPSD.env;\n    psd.env = patchGlobalPromise ? {\n        Promise: DexiePromise,\n        PromiseProp: { value: DexiePromise, configurable: true, writable: true },\n        all: DexiePromise.all,\n        race: DexiePromise.race,\n        allSettled: DexiePromise.allSettled,\n        any: DexiePromise.any,\n        resolve: DexiePromise.resolve,\n        reject: DexiePromise.reject,\n        nthen: getPatchedPromiseThen(globalEnv.nthen, psd),\n        gthen: getPatchedPromiseThen(globalEnv.gthen, psd)\n    } : {};\n    if (props$$1)\n        extend(psd, props$$1);\n    ++parent.ref;\n    psd.finalize = function () {\n        --this.parent.ref || this.parent.finalize();\n    };\n    var rv = usePSD(psd, fn, a1, a2);\n    if (psd.ref === 0)\n        psd.finalize();\n    return rv;\n}\nfunction incrementExpectedAwaits() {\n    if (!task.id)\n        task.id = ++taskCounter;\n    ++task.awaits;\n    task.echoes += ZONE_ECHO_LIMIT;\n    return task.id;\n}\nfunction decrementExpectedAwaits() {\n    if (!task.awaits)\n        return false;\n    if (--task.awaits === 0)\n        task.id = 0;\n    task.echoes = task.awaits * ZONE_ECHO_LIMIT;\n    return true;\n}\nif (('' + nativePromiseThen).indexOf('[native code]') === -1) {\n    incrementExpectedAwaits = decrementExpectedAwaits = nop;\n}\nfunction onPossibleParallellAsync(possiblePromise) {\n    if (task.echoes && possiblePromise && possiblePromise.constructor === NativePromise) {\n        incrementExpectedAwaits();\n        return possiblePromise.then(function (x) {\n            decrementExpectedAwaits();\n            return x;\n        }, function (e) {\n            decrementExpectedAwaits();\n            return rejection(e);\n        });\n    }\n    return possiblePromise;\n}\nfunction zoneEnterEcho(targetZone) {\n    ++totalEchoes;\n    if (!task.echoes || --task.echoes === 0) {\n        task.echoes = task.id = 0;\n    }\n    zoneStack.push(PSD);\n    switchToZone(targetZone, true);\n}\nfunction zoneLeaveEcho() {\n    var zone = zoneStack[zoneStack.length - 1];\n    zoneStack.pop();\n    switchToZone(zone, false);\n}\nfunction switchToZone(targetZone, bEnteringZone) {\n    var currentZone = PSD;\n    if (bEnteringZone ? task.echoes && (!zoneEchoes++ || targetZone !== PSD) : zoneEchoes && (!--zoneEchoes || targetZone !== PSD)) {\n        enqueueNativeMicroTask(bEnteringZone ? zoneEnterEcho.bind(null, targetZone) : zoneLeaveEcho);\n    }\n    if (targetZone === PSD)\n        return;\n    PSD = targetZone;\n    if (currentZone === globalPSD)\n        globalPSD.env = snapShot();\n    if (patchGlobalPromise) {\n        var GlobalPromise_1 = globalPSD.env.Promise;\n        var targetEnv = targetZone.env;\n        nativePromiseProto.then = targetEnv.nthen;\n        GlobalPromise_1.prototype.then = targetEnv.gthen;\n        if (currentZone.global || targetZone.global) {\n            Object.defineProperty(_global, 'Promise', targetEnv.PromiseProp);\n            GlobalPromise_1.all = targetEnv.all;\n            GlobalPromise_1.race = targetEnv.race;\n            GlobalPromise_1.resolve = targetEnv.resolve;\n            GlobalPromise_1.reject = targetEnv.reject;\n            if (targetEnv.allSettled)\n                GlobalPromise_1.allSettled = targetEnv.allSettled;\n            if (targetEnv.any)\n                GlobalPromise_1.any = targetEnv.any;\n        }\n    }\n}\nfunction snapShot() {\n    var GlobalPromise = _global.Promise;\n    return patchGlobalPromise ? {\n        Promise: GlobalPromise,\n        PromiseProp: Object.getOwnPropertyDescriptor(_global, \"Promise\"),\n        all: GlobalPromise.all,\n        race: GlobalPromise.race,\n        allSettled: GlobalPromise.allSettled,\n        any: GlobalPromise.any,\n        resolve: GlobalPromise.resolve,\n        reject: GlobalPromise.reject,\n        nthen: nativePromiseProto.then,\n        gthen: GlobalPromise.prototype.then\n    } : {};\n}\nfunction usePSD(psd, fn, a1, a2, a3) {\n    var outerScope = PSD;\n    try {\n        switchToZone(psd, true);\n        return fn(a1, a2, a3);\n    }\n    finally {\n        switchToZone(outerScope, false);\n    }\n}\nfunction enqueueNativeMicroTask(job) {\n    nativePromiseThen.call(resolvedNativePromise, job);\n}\nfunction nativeAwaitCompatibleWrap(fn, zone, possibleAwait, cleanup) {\n    return typeof fn !== 'function' ? fn : function () {\n        var outerZone = PSD;\n        if (possibleAwait)\n            incrementExpectedAwaits();\n        switchToZone(zone, true);\n        try {\n            return fn.apply(this, arguments);\n        }\n        finally {\n            switchToZone(outerZone, false);\n            if (cleanup)\n                enqueueNativeMicroTask(decrementExpectedAwaits);\n        }\n    };\n}\nfunction getPatchedPromiseThen(origThen, zone) {\n    return function (onResolved, onRejected) {\n        return origThen.call(this, nativeAwaitCompatibleWrap(onResolved, zone), nativeAwaitCompatibleWrap(onRejected, zone));\n    };\n}\nvar UNHANDLEDREJECTION = \"unhandledrejection\";\nfunction globalError(err, promise) {\n    var rv;\n    try {\n        rv = promise.onuncatched(err);\n    }\n    catch (e) { }\n    if (rv !== false)\n        try {\n            var event, eventData = { promise: promise, reason: err };\n            if (_global.document && document.createEvent) {\n                event = document.createEvent('Event');\n                event.initEvent(UNHANDLEDREJECTION, true, true);\n                extend(event, eventData);\n            }\n            else if (_global.CustomEvent) {\n                event = new CustomEvent(UNHANDLEDREJECTION, { detail: eventData });\n                extend(event, eventData);\n            }\n            if (event && _global.dispatchEvent) {\n                dispatchEvent(event);\n                if (!_global.PromiseRejectionEvent && _global.onunhandledrejection)\n                    try {\n                        _global.onunhandledrejection(event);\n                    }\n                    catch (_) { }\n            }\n            if (debug && event && !event.defaultPrevented) {\n                console.warn(\"Unhandled rejection: \" + (err.stack || err));\n            }\n        }\n        catch (e) { }\n}\nvar rejection = DexiePromise.reject;\n\nfunction tempTransaction(db, mode, storeNames, fn) {\n    if (!db._state.openComplete && (!PSD.letThrough)) {\n        if (!db._state.isBeingOpened) {\n            if (!db._options.autoOpen)\n                return rejection(new exceptions.DatabaseClosed());\n            db.open().catch(nop);\n        }\n        return db._state.dbReadyPromise.then(function () { return tempTransaction(db, mode, storeNames, fn); });\n    }\n    else {\n        var trans = db._createTransaction(mode, storeNames, db._dbSchema);\n        try {\n            trans.create();\n        }\n        catch (ex) {\n            return rejection(ex);\n        }\n        return trans._promise(mode, function (resolve, reject) {\n            return newScope(function () {\n                PSD.trans = trans;\n                return fn(resolve, reject, trans);\n            });\n        }).then(function (result) {\n            return trans._completion.then(function () { return result; });\n        });\n    }\n}\n\nvar DEXIE_VERSION = '3.0.3';\nvar maxString = String.fromCharCode(65535);\nvar minKey = -Infinity;\nvar INVALID_KEY_ARGUMENT = \"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.\";\nvar STRING_EXPECTED = \"String expected.\";\nvar connections = [];\nvar isIEOrEdge = typeof navigator !== 'undefined' && /(MSIE|Trident|Edge)/.test(navigator.userAgent);\nvar hasIEDeleteObjectStoreBug = isIEOrEdge;\nvar hangsOnDeleteLargeKeyRange = isIEOrEdge;\nvar dexieStackFrameFilter = function (frame) { return !/(dexie\\.js|dexie\\.min\\.js)/.test(frame); };\nvar DBNAMES_DB = '__dbnames';\nvar READONLY = 'readonly';\nvar READWRITE = 'readwrite';\n\nfunction combine(filter1, filter2) {\n    return filter1 ?\n        filter2 ?\n            function () { return filter1.apply(this, arguments) && filter2.apply(this, arguments); } :\n            filter1 :\n        filter2;\n}\n\nvar AnyRange = {\n    type: 3          ,\n    lower: -Infinity,\n    lowerOpen: false,\n    upper: [[]],\n    upperOpen: false\n};\n\nfunction workaroundForUndefinedPrimKey(keyPath) {\n    return function (obj) {\n        if (getByKeyPath(obj, keyPath) === undefined) {\n            obj = deepClone(obj);\n            delByKeyPath(obj, keyPath);\n        }\n        return obj;\n    };\n}\n\nvar Table =               (function () {\n    function Table() {\n    }\n    Table.prototype._trans = function (mode, fn, writeLocked) {\n        var trans = this._tx || PSD.trans;\n        var tableName = this.name;\n        function checkTableInTransaction(resolve, reject, trans) {\n            if (!trans.schema[tableName])\n                throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n            return fn(trans.idbtrans, trans);\n        }\n        var wasRootExec = beginMicroTickScope();\n        try {\n            return trans && trans.db === this.db ?\n                trans === PSD.trans ?\n                    trans._promise(mode, checkTableInTransaction, writeLocked) :\n                    newScope(function () { return trans._promise(mode, checkTableInTransaction, writeLocked); }, { trans: trans, transless: PSD.transless || PSD }) :\n                tempTransaction(this.db, mode, [this.name], checkTableInTransaction);\n        }\n        finally {\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    };\n    Table.prototype.get = function (keyOrCrit, cb) {\n        var _this = this;\n        if (keyOrCrit && keyOrCrit.constructor === Object)\n            return this.where(keyOrCrit).first(cb);\n        return this._trans('readonly', function (trans) {\n            return _this.core.get({ trans: trans, key: keyOrCrit })\n                .then(function (res) { return _this.hook.reading.fire(res); });\n        }).then(cb);\n    };\n    Table.prototype.where = function (indexOrCrit) {\n        if (typeof indexOrCrit === 'string')\n            return new this.db.WhereClause(this, indexOrCrit);\n        if (isArray(indexOrCrit))\n            return new this.db.WhereClause(this, \"[\" + indexOrCrit.join('+') + \"]\");\n        var keyPaths = keys(indexOrCrit);\n        if (keyPaths.length === 1)\n            return this\n                .where(keyPaths[0])\n                .equals(indexOrCrit[keyPaths[0]]);\n        var compoundIndex = this.schema.indexes.concat(this.schema.primKey).filter(function (ix) {\n            return ix.compound &&\n                keyPaths.every(function (keyPath) { return ix.keyPath.indexOf(keyPath) >= 0; }) &&\n                ix.keyPath.every(function (keyPath) { return keyPaths.indexOf(keyPath) >= 0; });\n        })[0];\n        if (compoundIndex && this.db._maxKey !== maxString)\n            return this\n                .where(compoundIndex.name)\n                .equals(compoundIndex.keyPath.map(function (kp) { return indexOrCrit[kp]; }));\n        if (!compoundIndex && debug)\n            console.warn(\"The query \" + JSON.stringify(indexOrCrit) + \" on \" + this.name + \" would benefit of a \" +\n                (\"compound index [\" + keyPaths.join('+') + \"]\"));\n        var idxByName = this.schema.idxByName;\n        var idb = this.db._deps.indexedDB;\n        function equals(a, b) {\n            try {\n                return idb.cmp(a, b) === 0;\n            }\n            catch (e) {\n                return false;\n            }\n        }\n        var _a = keyPaths.reduce(function (_a, keyPath) {\n            var prevIndex = _a[0], prevFilterFn = _a[1];\n            var index = idxByName[keyPath];\n            var value = indexOrCrit[keyPath];\n            return [\n                prevIndex || index,\n                prevIndex || !index ?\n                    combine(prevFilterFn, index && index.multi ?\n                        function (x) {\n                            var prop = getByKeyPath(x, keyPath);\n                            return isArray(prop) && prop.some(function (item) { return equals(value, item); });\n                        } : function (x) { return equals(value, getByKeyPath(x, keyPath)); })\n                    : prevFilterFn\n            ];\n        }, [null, null]), idx = _a[0], filterFunction = _a[1];\n        return idx ?\n            this.where(idx.name).equals(indexOrCrit[idx.keyPath])\n                .filter(filterFunction) :\n            compoundIndex ?\n                this.filter(filterFunction) :\n                this.where(keyPaths).equals('');\n    };\n    Table.prototype.filter = function (filterFunction) {\n        return this.toCollection().and(filterFunction);\n    };\n    Table.prototype.count = function (thenShortcut) {\n        return this.toCollection().count(thenShortcut);\n    };\n    Table.prototype.offset = function (offset) {\n        return this.toCollection().offset(offset);\n    };\n    Table.prototype.limit = function (numRows) {\n        return this.toCollection().limit(numRows);\n    };\n    Table.prototype.each = function (callback) {\n        return this.toCollection().each(callback);\n    };\n    Table.prototype.toArray = function (thenShortcut) {\n        return this.toCollection().toArray(thenShortcut);\n    };\n    Table.prototype.toCollection = function () {\n        return new this.db.Collection(new this.db.WhereClause(this));\n    };\n    Table.prototype.orderBy = function (index) {\n        return new this.db.Collection(new this.db.WhereClause(this, isArray(index) ?\n            \"[\" + index.join('+') + \"]\" :\n            index));\n    };\n    Table.prototype.reverse = function () {\n        return this.toCollection().reverse();\n    };\n    Table.prototype.mapToClass = function (constructor) {\n        this.schema.mappedClass = constructor;\n        var readHook = function (obj) {\n            if (!obj)\n                return obj;\n            var res = Object.create(constructor.prototype);\n            for (var m in obj)\n                if (hasOwn(obj, m))\n                    try {\n                        res[m] = obj[m];\n                    }\n                    catch (_) { }\n            return res;\n        };\n        if (this.schema.readHook) {\n            this.hook.reading.unsubscribe(this.schema.readHook);\n        }\n        this.schema.readHook = readHook;\n        this.hook(\"reading\", readHook);\n        return constructor;\n    };\n    Table.prototype.defineClass = function () {\n        function Class(content) {\n            extend(this, content);\n        }\n        \n        return this.mapToClass(Class);\n    };\n    Table.prototype.add = function (obj, key) {\n        var _this = this;\n        var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n        var objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', function (trans) {\n            return _this.core.mutate({ trans: trans, type: 'add', keys: key != null ? [key] : null, values: [objToAdd] });\n        }).then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n            .then(function (lastResult) {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n                \n            }\n            return lastResult;\n        });\n    };\n    Table.prototype.update = function (keyOrObject, modifications) {\n        if (typeof modifications !== 'object' || isArray(modifications))\n            throw new exceptions.InvalidArgument(\"Modifications must be an object.\");\n        if (typeof keyOrObject === 'object' && !isArray(keyOrObject)) {\n            keys(modifications).forEach(function (keyPath) {\n                setByKeyPath(keyOrObject, keyPath, modifications[keyPath]);\n            });\n            var key = getByKeyPath(keyOrObject, this.schema.primKey.keyPath);\n            if (key === undefined)\n                return rejection(new exceptions.InvalidArgument(\"Given object does not contain its primary key\"));\n            return this.where(\":id\").equals(key).modify(modifications);\n        }\n        else {\n            return this.where(\":id\").equals(keyOrObject).modify(modifications);\n        }\n    };\n    Table.prototype.put = function (obj, key) {\n        var _this = this;\n        var _a = this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n        var objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'put', values: [objToAdd], keys: key != null ? [key] : null }); })\n            .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult; })\n            .then(function (lastResult) {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n                \n            }\n            return lastResult;\n        });\n    };\n    Table.prototype.delete = function (key) {\n        var _this = this;\n        return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'delete', keys: [key] }); })\n            .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n    };\n    Table.prototype.clear = function () {\n        var _this = this;\n        return this._trans('readwrite', function (trans) { return _this.core.mutate({ trans: trans, type: 'deleteRange', range: AnyRange }); })\n            .then(function (res) { return res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined; });\n    };\n    Table.prototype.bulkGet = function (keys$$1) {\n        var _this = this;\n        return this._trans('readonly', function (trans) {\n            return _this.core.getMany({\n                keys: keys$$1,\n                trans: trans\n            }).then(function (result) { return result.map(function (res) { return _this.hook.reading.fire(res); }); });\n        });\n    };\n    Table.prototype.bulkAdd = function (objects, keysOrOptions, options) {\n        var _this = this;\n        var keys$$1 = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys$$1 ? undefined : keysOrOptions);\n        var wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', function (trans) {\n            var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            if (keyPath && keys$$1)\n                throw new exceptions.InvalidArgument(\"bulkAdd(): keys argument invalid on tables with inbound keys\");\n            if (keys$$1 && keys$$1.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            var numObjects = objects.length;\n            var objectsToAdd = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return _this.core.mutate({ trans: trans, type: 'add', keys: keys$$1, values: objectsToAdd, wantResults: wantResults })\n                .then(function (_a) {\n                var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                var result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(_this.name + \".bulkAdd(): \" + numFailures + \" of \" + numObjects + \" operations failed\", Object.keys(failures).map(function (pos) { return failures[pos]; }));\n            });\n        });\n    };\n    Table.prototype.bulkPut = function (objects, keysOrOptions, options) {\n        var _this = this;\n        var keys$$1 = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys$$1 ? undefined : keysOrOptions);\n        var wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', function (trans) {\n            var _a = _this.schema.primKey, auto = _a.auto, keyPath = _a.keyPath;\n            if (keyPath && keys$$1)\n                throw new exceptions.InvalidArgument(\"bulkPut(): keys argument invalid on tables with inbound keys\");\n            if (keys$$1 && keys$$1.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            var numObjects = objects.length;\n            var objectsToPut = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return _this.core.mutate({ trans: trans, type: 'put', keys: keys$$1, values: objectsToPut, wantResults: wantResults })\n                .then(function (_a) {\n                var numFailures = _a.numFailures, results = _a.results, lastResult = _a.lastResult, failures = _a.failures;\n                var result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(_this.name + \".bulkPut(): \" + numFailures + \" of \" + numObjects + \" operations failed\", Object.keys(failures).map(function (pos) { return failures[pos]; }));\n            });\n        });\n    };\n    Table.prototype.bulkDelete = function (keys$$1) {\n        var _this = this;\n        var numKeys = keys$$1.length;\n        return this._trans('readwrite', function (trans) {\n            return _this.core.mutate({ trans: trans, type: 'delete', keys: keys$$1 });\n        }).then(function (_a) {\n            var numFailures = _a.numFailures, lastResult = _a.lastResult, failures = _a.failures;\n            if (numFailures === 0)\n                return lastResult;\n            throw new BulkError(_this.name + \".bulkDelete(): \" + numFailures + \" of \" + numKeys + \" operations failed\", failures);\n        });\n    };\n    return Table;\n}());\n\nfunction Events(ctx) {\n    var evs = {};\n    var rv = function (eventName, subscriber) {\n        if (subscriber) {\n            var i = arguments.length, args = new Array(i - 1);\n            while (--i)\n                args[i - 1] = arguments[i];\n            evs[eventName].subscribe.apply(null, args);\n            return ctx;\n        }\n        else if (typeof (eventName) === 'string') {\n            return evs[eventName];\n        }\n    };\n    rv.addEventType = add;\n    for (var i = 1, l = arguments.length; i < l; ++i) {\n        add(arguments[i]);\n    }\n    return rv;\n    function add(eventName, chainFunction, defaultFunction) {\n        if (typeof eventName === 'object')\n            return addConfiguredEvents(eventName);\n        if (!chainFunction)\n            chainFunction = reverseStoppableEventChain;\n        if (!defaultFunction)\n            defaultFunction = nop;\n        var context = {\n            subscribers: [],\n            fire: defaultFunction,\n            subscribe: function (cb) {\n                if (context.subscribers.indexOf(cb) === -1) {\n                    context.subscribers.push(cb);\n                    context.fire = chainFunction(context.fire, cb);\n                }\n            },\n            unsubscribe: function (cb) {\n                context.subscribers = context.subscribers.filter(function (fn) { return fn !== cb; });\n                context.fire = context.subscribers.reduce(chainFunction, defaultFunction);\n            }\n        };\n        evs[eventName] = rv[eventName] = context;\n        return context;\n    }\n    function addConfiguredEvents(cfg) {\n        keys(cfg).forEach(function (eventName) {\n            var args = cfg[eventName];\n            if (isArray(args)) {\n                add(eventName, cfg[eventName][0], cfg[eventName][1]);\n            }\n            else if (args === 'asap') {\n                var context = add(eventName, mirror, function fire() {\n                    var i = arguments.length, args = new Array(i);\n                    while (i--)\n                        args[i] = arguments[i];\n                    context.subscribers.forEach(function (fn) {\n                        asap(function fireEvent() {\n                            fn.apply(null, args);\n                        });\n                    });\n                });\n            }\n            else\n                throw new exceptions.InvalidArgument(\"Invalid event config\");\n        });\n    }\n}\n\nfunction makeClassConstructor(prototype, constructor) {\n    derive(constructor).from({ prototype: prototype });\n    return constructor;\n}\n\nfunction createTableConstructor(db) {\n    return makeClassConstructor(Table.prototype, function Table$$1(name, tableSchema, trans) {\n        this.db = db;\n        this._tx = trans;\n        this.name = name;\n        this.schema = tableSchema;\n        this.hook = db._allTables[name] ? db._allTables[name].hook : Events(null, {\n            \"creating\": [hookCreatingChain, nop],\n            \"reading\": [pureFunctionChain, mirror],\n            \"updating\": [hookUpdatingChain, nop],\n            \"deleting\": [hookDeletingChain, nop]\n        });\n    });\n}\n\nfunction isPlainKeyRange(ctx, ignoreLimitFilter) {\n    return !(ctx.filter || ctx.algorithm || ctx.or) &&\n        (ignoreLimitFilter ? ctx.justLimit : !ctx.replayFilter);\n}\nfunction addFilter(ctx, fn) {\n    ctx.filter = combine(ctx.filter, fn);\n}\nfunction addReplayFilter(ctx, factory, isLimitFilter) {\n    var curr = ctx.replayFilter;\n    ctx.replayFilter = curr ? function () { return combine(curr(), factory()); } : factory;\n    ctx.justLimit = isLimitFilter && !curr;\n}\nfunction addMatchFilter(ctx, fn) {\n    ctx.isMatch = combine(ctx.isMatch, fn);\n}\nfunction getIndexOrStore(ctx, coreSchema) {\n    if (ctx.isPrimKey)\n        return coreSchema.primaryKey;\n    var index = coreSchema.getIndexByKeyPath(ctx.index);\n    if (!index)\n        throw new exceptions.Schema(\"KeyPath \" + ctx.index + \" on object store \" + coreSchema.name + \" is not indexed\");\n    return index;\n}\nfunction openCursor(ctx, coreTable, trans) {\n    var index = getIndexOrStore(ctx, coreTable.schema);\n    return coreTable.openCursor({\n        trans: trans,\n        values: !ctx.keysOnly,\n        reverse: ctx.dir === 'prev',\n        unique: !!ctx.unique,\n        query: {\n            index: index,\n            range: ctx.range\n        }\n    });\n}\nfunction iter(ctx, fn, coreTrans, coreTable) {\n    var filter = ctx.replayFilter ? combine(ctx.filter, ctx.replayFilter()) : ctx.filter;\n    if (!ctx.or) {\n        return iterate(openCursor(ctx, coreTable, coreTrans), combine(ctx.algorithm, filter), fn, !ctx.keysOnly && ctx.valueMapper);\n    }\n    else {\n        var set_1 = {};\n        var union = function (item, cursor, advance) {\n            if (!filter || filter(cursor, advance, function (result) { return cursor.stop(result); }, function (err) { return cursor.fail(err); })) {\n                var primaryKey = cursor.primaryKey;\n                var key = '' + primaryKey;\n                if (key === '[object ArrayBuffer]')\n                    key = '' + new Uint8Array(primaryKey);\n                if (!hasOwn(set_1, key)) {\n                    set_1[key] = true;\n                    fn(item, cursor, advance);\n                }\n            }\n        };\n        return Promise.all([\n            ctx.or._iterate(union, coreTrans),\n            iterate(openCursor(ctx, coreTable, coreTrans), ctx.algorithm, union, !ctx.keysOnly && ctx.valueMapper)\n        ]);\n    }\n}\nfunction iterate(cursorPromise, filter, fn, valueMapper) {\n    var mappedFn = valueMapper ? function (x, c, a) { return fn(valueMapper(x), c, a); } : fn;\n    var wrappedFn = wrap(mappedFn);\n    return cursorPromise.then(function (cursor) {\n        if (cursor) {\n            return cursor.start(function () {\n                var c = function () { return cursor.continue(); };\n                if (!filter || filter(cursor, function (advancer) { return c = advancer; }, function (val) { cursor.stop(val); c = nop; }, function (e) { cursor.fail(e); c = nop; }))\n                    wrappedFn(cursor.value, cursor, function (advancer) { return c = advancer; });\n                c();\n            });\n        }\n    });\n}\n\nvar Collection =               (function () {\n    function Collection() {\n    }\n    Collection.prototype._read = function (fn, cb) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readonly', fn).then(cb);\n    };\n    Collection.prototype._write = function (fn) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readwrite', fn, \"locked\");\n    };\n    Collection.prototype._addAlgorithm = function (fn) {\n        var ctx = this._ctx;\n        ctx.algorithm = combine(ctx.algorithm, fn);\n    };\n    Collection.prototype._iterate = function (fn, coreTrans) {\n        return iter(this._ctx, fn, coreTrans, this._ctx.table.core);\n    };\n    Collection.prototype.clone = function (props$$1) {\n        var rv = Object.create(this.constructor.prototype), ctx = Object.create(this._ctx);\n        if (props$$1)\n            extend(ctx, props$$1);\n        rv._ctx = ctx;\n        return rv;\n    };\n    Collection.prototype.raw = function () {\n        this._ctx.valueMapper = null;\n        return this;\n    };\n    Collection.prototype.each = function (fn) {\n        var ctx = this._ctx;\n        return this._read(function (trans) { return iter(ctx, fn, trans, ctx.table.core); });\n    };\n    Collection.prototype.count = function (cb) {\n        var _this = this;\n        return this._read(function (trans) {\n            var ctx = _this._ctx;\n            var coreTable = ctx.table.core;\n            if (isPlainKeyRange(ctx, true)) {\n                return coreTable.count({\n                    trans: trans,\n                    query: {\n                        index: getIndexOrStore(ctx, coreTable.schema),\n                        range: ctx.range\n                    }\n                }).then(function (count) { return Math.min(count, ctx.limit); });\n            }\n            else {\n                var count = 0;\n                return iter(ctx, function () { ++count; return false; }, trans, coreTable)\n                    .then(function () { return count; });\n            }\n        }).then(cb);\n    };\n    Collection.prototype.sortBy = function (keyPath, cb) {\n        var parts = keyPath.split('.').reverse(), lastPart = parts[0], lastIndex = parts.length - 1;\n        function getval(obj, i) {\n            if (i)\n                return getval(obj[parts[i]], i - 1);\n            return obj[lastPart];\n        }\n        var order = this._ctx.dir === \"next\" ? 1 : -1;\n        function sorter(a, b) {\n            var aVal = getval(a, lastIndex), bVal = getval(b, lastIndex);\n            return aVal < bVal ? -order : aVal > bVal ? order : 0;\n        }\n        return this.toArray(function (a) {\n            return a.sort(sorter);\n        }).then(cb);\n    };\n    Collection.prototype.toArray = function (cb) {\n        var _this = this;\n        return this._read(function (trans) {\n            var ctx = _this._ctx;\n            if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                var valueMapper_1 = ctx.valueMapper;\n                var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans: trans,\n                    limit: ctx.limit,\n                    values: true,\n                    query: {\n                        index: index,\n                        range: ctx.range\n                    }\n                }).then(function (_a) {\n                    var result = _a.result;\n                    return valueMapper_1 ? result.map(valueMapper_1) : result;\n                });\n            }\n            else {\n                var a_1 = [];\n                return iter(ctx, function (item) { return a_1.push(item); }, trans, ctx.table.core).then(function () { return a_1; });\n            }\n        }, cb);\n    };\n    Collection.prototype.offset = function (offset) {\n        var ctx = this._ctx;\n        if (offset <= 0)\n            return this;\n        ctx.offset += offset;\n        if (isPlainKeyRange(ctx)) {\n            addReplayFilter(ctx, function () {\n                var offsetLeft = offset;\n                return function (cursor, advance) {\n                    if (offsetLeft === 0)\n                        return true;\n                    if (offsetLeft === 1) {\n                        --offsetLeft;\n                        return false;\n                    }\n                    advance(function () {\n                        cursor.advance(offsetLeft);\n                        offsetLeft = 0;\n                    });\n                    return false;\n                };\n            });\n        }\n        else {\n            addReplayFilter(ctx, function () {\n                var offsetLeft = offset;\n                return function () { return (--offsetLeft < 0); };\n            });\n        }\n        return this;\n    };\n    Collection.prototype.limit = function (numRows) {\n        this._ctx.limit = Math.min(this._ctx.limit, numRows);\n        addReplayFilter(this._ctx, function () {\n            var rowsLeft = numRows;\n            return function (cursor, advance, resolve) {\n                if (--rowsLeft <= 0)\n                    advance(resolve);\n                return rowsLeft >= 0;\n            };\n        }, true);\n        return this;\n    };\n    Collection.prototype.until = function (filterFunction, bIncludeStopEntry) {\n        addFilter(this._ctx, function (cursor, advance, resolve) {\n            if (filterFunction(cursor.value)) {\n                advance(resolve);\n                return bIncludeStopEntry;\n            }\n            else {\n                return true;\n            }\n        });\n        return this;\n    };\n    Collection.prototype.first = function (cb) {\n        return this.limit(1).toArray(function (a) { return a[0]; }).then(cb);\n    };\n    Collection.prototype.last = function (cb) {\n        return this.reverse().first(cb);\n    };\n    Collection.prototype.filter = function (filterFunction) {\n        addFilter(this._ctx, function (cursor) {\n            return filterFunction(cursor.value);\n        });\n        addMatchFilter(this._ctx, filterFunction);\n        return this;\n    };\n    Collection.prototype.and = function (filter) {\n        return this.filter(filter);\n    };\n    Collection.prototype.or = function (indexName) {\n        return new this.db.WhereClause(this._ctx.table, indexName, this);\n    };\n    Collection.prototype.reverse = function () {\n        this._ctx.dir = (this._ctx.dir === \"prev\" ? \"next\" : \"prev\");\n        if (this._ondirectionchange)\n            this._ondirectionchange(this._ctx.dir);\n        return this;\n    };\n    Collection.prototype.desc = function () {\n        return this.reverse();\n    };\n    Collection.prototype.eachKey = function (cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.key, cursor); });\n    };\n    Collection.prototype.eachUniqueKey = function (cb) {\n        this._ctx.unique = \"unique\";\n        return this.eachKey(cb);\n    };\n    Collection.prototype.eachPrimaryKey = function (cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.primaryKey, cursor); });\n    };\n    Collection.prototype.keys = function (cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.key);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    };\n    Collection.prototype.primaryKeys = function (cb) {\n        var ctx = this._ctx;\n        if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n            return this._read(function (trans) {\n                var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans: trans,\n                    values: false,\n                    limit: ctx.limit,\n                    query: {\n                        index: index,\n                        range: ctx.range\n                    }\n                });\n            }).then(function (_a) {\n                var result = _a.result;\n                return result;\n            }).then(cb);\n        }\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.primaryKey);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    };\n    Collection.prototype.uniqueKeys = function (cb) {\n        this._ctx.unique = \"unique\";\n        return this.keys(cb);\n    };\n    Collection.prototype.firstKey = function (cb) {\n        return this.limit(1).keys(function (a) { return a[0]; }).then(cb);\n    };\n    Collection.prototype.lastKey = function (cb) {\n        return this.reverse().firstKey(cb);\n    };\n    Collection.prototype.distinct = function () {\n        var ctx = this._ctx, idx = ctx.index && ctx.table.schema.idxByName[ctx.index];\n        if (!idx || !idx.multi)\n            return this;\n        var set = {};\n        addFilter(this._ctx, function (cursor) {\n            var strKey = cursor.primaryKey.toString();\n            var found = hasOwn(set, strKey);\n            set[strKey] = true;\n            return !found;\n        });\n        return this;\n    };\n    Collection.prototype.modify = function (changes) {\n        var _this = this;\n        var ctx = this._ctx;\n        return this._write(function (trans) {\n            var modifyer;\n            if (typeof changes === 'function') {\n                modifyer = changes;\n            }\n            else {\n                var keyPaths = keys(changes);\n                var numKeys = keyPaths.length;\n                modifyer = function (item) {\n                    var anythingModified = false;\n                    for (var i = 0; i < numKeys; ++i) {\n                        var keyPath = keyPaths[i], val = changes[keyPath];\n                        if (getByKeyPath(item, keyPath) !== val) {\n                            setByKeyPath(item, keyPath, val);\n                            anythingModified = true;\n                        }\n                    }\n                    return anythingModified;\n                };\n            }\n            var coreTable = ctx.table.core;\n            var _a = coreTable.schema.primaryKey, outbound = _a.outbound, extractKey = _a.extractKey;\n            var limit = 'testmode' in Dexie ? 1 : 2000;\n            var cmp = _this.db.core.cmp;\n            var totalFailures = [];\n            var successCount = 0;\n            var failedKeys = [];\n            var applyMutateResult = function (expectedCount, res) {\n                var failures = res.failures, numFailures = res.numFailures;\n                successCount += expectedCount - numFailures;\n                for (var _i = 0, _a = keys(failures); _i < _a.length; _i++) {\n                    var pos = _a[_i];\n                    totalFailures.push(failures[pos]);\n                }\n            };\n            return _this.clone().primaryKeys().then(function (keys$$1) {\n                var nextChunk = function (offset) {\n                    var count = Math.min(limit, keys$$1.length - offset);\n                    return coreTable.getMany({ trans: trans, keys: keys$$1.slice(offset, offset + count) }).then(function (values) {\n                        var addValues = [];\n                        var putValues = [];\n                        var putKeys = outbound ? [] : null;\n                        var deleteKeys = [];\n                        for (var i = 0; i < count; ++i) {\n                            var origValue = values[i];\n                            var ctx_1 = {\n                                value: deepClone(origValue),\n                                primKey: keys$$1[offset + i]\n                            };\n                            if (modifyer.call(ctx_1, ctx_1.value, ctx_1) !== false) {\n                                if (ctx_1.value == null) {\n                                    deleteKeys.push(keys$$1[offset + i]);\n                                }\n                                else if (!outbound && cmp(extractKey(origValue), extractKey(ctx_1.value)) !== 0) {\n                                    deleteKeys.push(keys$$1[offset + i]);\n                                    addValues.push(ctx_1.value);\n                                }\n                                else {\n                                    putValues.push(ctx_1.value);\n                                    if (outbound)\n                                        putKeys.push(keys$$1[offset + i]);\n                                }\n                            }\n                        }\n                        return Promise.resolve(addValues.length > 0 &&\n                            coreTable.mutate({ trans: trans, type: 'add', values: addValues })\n                                .then(function (res) {\n                                for (var pos in res.failures) {\n                                    deleteKeys.splice(parseInt(pos), 1);\n                                }\n                                applyMutateResult(addValues.length, res);\n                            })).then(function (res) { return putValues.length > 0 &&\n                            coreTable.mutate({ trans: trans, type: 'put', keys: putKeys, values: putValues })\n                                .then(function (res) { return applyMutateResult(putValues.length, res); }); }).then(function () { return deleteKeys.length > 0 &&\n                            coreTable.mutate({ trans: trans, type: 'delete', keys: deleteKeys })\n                                .then(function (res) { return applyMutateResult(deleteKeys.length, res); }); }).then(function () {\n                            return keys$$1.length > offset + count && nextChunk(offset + limit);\n                        });\n                    });\n                };\n                return nextChunk(0).then(function () {\n                    if (totalFailures.length > 0)\n                        throw new ModifyError(\"Error modifying one or more objects\", totalFailures, successCount, failedKeys);\n                    return keys$$1.length;\n                });\n            });\n        });\n    };\n    Collection.prototype.delete = function () {\n        var ctx = this._ctx, range = ctx.range;\n        if (isPlainKeyRange(ctx) &&\n            ((ctx.isPrimKey && !hangsOnDeleteLargeKeyRange) || range.type === 3          ))\n         {\n            return this._write(function (trans) {\n                var primaryKey = ctx.table.core.schema.primaryKey;\n                var coreRange = range;\n                return ctx.table.core.count({ trans: trans, query: { index: primaryKey, range: coreRange } }).then(function (count) {\n                    return ctx.table.core.mutate({ trans: trans, type: 'deleteRange', range: coreRange })\n                        .then(function (_a) {\n                        var failures = _a.failures, lastResult = _a.lastResult, results = _a.results, numFailures = _a.numFailures;\n                        if (numFailures)\n                            throw new ModifyError(\"Could not delete some values\", Object.keys(failures).map(function (pos) { return failures[pos]; }), count - numFailures);\n                        return count - numFailures;\n                    });\n                });\n            });\n        }\n        return this.modify(function (value, ctx) { return ctx.value = null; });\n    };\n    return Collection;\n}());\n\nfunction createCollectionConstructor(db) {\n    return makeClassConstructor(Collection.prototype, function Collection$$1(whereClause, keyRangeGenerator) {\n        this.db = db;\n        var keyRange = AnyRange, error = null;\n        if (keyRangeGenerator)\n            try {\n                keyRange = keyRangeGenerator();\n            }\n            catch (ex) {\n                error = ex;\n            }\n        var whereCtx = whereClause._ctx;\n        var table = whereCtx.table;\n        var readingHook = table.hook.reading.fire;\n        this._ctx = {\n            table: table,\n            index: whereCtx.index,\n            isPrimKey: (!whereCtx.index || (table.schema.primKey.keyPath && whereCtx.index === table.schema.primKey.name)),\n            range: keyRange,\n            keysOnly: false,\n            dir: \"next\",\n            unique: \"\",\n            algorithm: null,\n            filter: null,\n            replayFilter: null,\n            justLimit: true,\n            isMatch: null,\n            offset: 0,\n            limit: Infinity,\n            error: error,\n            or: whereCtx.or,\n            valueMapper: readingHook !== mirror ? readingHook : null\n        };\n    });\n}\n\nfunction simpleCompare(a, b) {\n    return a < b ? -1 : a === b ? 0 : 1;\n}\nfunction simpleCompareReverse(a, b) {\n    return a > b ? -1 : a === b ? 0 : 1;\n}\n\nfunction fail(collectionOrWhereClause, err, T) {\n    var collection = collectionOrWhereClause instanceof WhereClause ?\n        new collectionOrWhereClause.Collection(collectionOrWhereClause) :\n        collectionOrWhereClause;\n    collection._ctx.error = T ? new T(err) : new TypeError(err);\n    return collection;\n}\nfunction emptyCollection(whereClause) {\n    return new whereClause.Collection(whereClause, function () { return rangeEqual(\"\"); }).limit(0);\n}\nfunction upperFactory(dir) {\n    return dir === \"next\" ?\n        function (s) { return s.toUpperCase(); } :\n        function (s) { return s.toLowerCase(); };\n}\nfunction lowerFactory(dir) {\n    return dir === \"next\" ?\n        function (s) { return s.toLowerCase(); } :\n        function (s) { return s.toUpperCase(); };\n}\nfunction nextCasing(key, lowerKey, upperNeedle, lowerNeedle, cmp, dir) {\n    var length = Math.min(key.length, lowerNeedle.length);\n    var llp = -1;\n    for (var i = 0; i < length; ++i) {\n        var lwrKeyChar = lowerKey[i];\n        if (lwrKeyChar !== lowerNeedle[i]) {\n            if (cmp(key[i], upperNeedle[i]) < 0)\n                return key.substr(0, i) + upperNeedle[i] + upperNeedle.substr(i + 1);\n            if (cmp(key[i], lowerNeedle[i]) < 0)\n                return key.substr(0, i) + lowerNeedle[i] + upperNeedle.substr(i + 1);\n            if (llp >= 0)\n                return key.substr(0, llp) + lowerKey[llp] + upperNeedle.substr(llp + 1);\n            return null;\n        }\n        if (cmp(key[i], lwrKeyChar) < 0)\n            llp = i;\n    }\n    if (length < lowerNeedle.length && dir === \"next\")\n        return key + upperNeedle.substr(key.length);\n    if (length < key.length && dir === \"prev\")\n        return key.substr(0, upperNeedle.length);\n    return (llp < 0 ? null : key.substr(0, llp) + lowerNeedle[llp] + upperNeedle.substr(llp + 1));\n}\nfunction addIgnoreCaseAlgorithm(whereClause, match, needles, suffix) {\n    var upper, lower, compare, upperNeedles, lowerNeedles, direction, nextKeySuffix, needlesLen = needles.length;\n    if (!needles.every(function (s) { return typeof s === 'string'; })) {\n        return fail(whereClause, STRING_EXPECTED);\n    }\n    function initDirection(dir) {\n        upper = upperFactory(dir);\n        lower = lowerFactory(dir);\n        compare = (dir === \"next\" ? simpleCompare : simpleCompareReverse);\n        var needleBounds = needles.map(function (needle) {\n            return { lower: lower(needle), upper: upper(needle) };\n        }).sort(function (a, b) {\n            return compare(a.lower, b.lower);\n        });\n        upperNeedles = needleBounds.map(function (nb) { return nb.upper; });\n        lowerNeedles = needleBounds.map(function (nb) { return nb.lower; });\n        direction = dir;\n        nextKeySuffix = (dir === \"next\" ? \"\" : suffix);\n    }\n    initDirection(\"next\");\n    var c = new whereClause.Collection(whereClause, function () { return createRange(upperNeedles[0], lowerNeedles[needlesLen - 1] + suffix); });\n    c._ondirectionchange = function (direction) {\n        initDirection(direction);\n    };\n    var firstPossibleNeedle = 0;\n    c._addAlgorithm(function (cursor, advance, resolve) {\n        var key = cursor.key;\n        if (typeof key !== 'string')\n            return false;\n        var lowerKey = lower(key);\n        if (match(lowerKey, lowerNeedles, firstPossibleNeedle)) {\n            return true;\n        }\n        else {\n            var lowestPossibleCasing = null;\n            for (var i = firstPossibleNeedle; i < needlesLen; ++i) {\n                var casing = nextCasing(key, lowerKey, upperNeedles[i], lowerNeedles[i], compare, direction);\n                if (casing === null && lowestPossibleCasing === null)\n                    firstPossibleNeedle = i + 1;\n                else if (lowestPossibleCasing === null || compare(lowestPossibleCasing, casing) > 0) {\n                    lowestPossibleCasing = casing;\n                }\n            }\n            if (lowestPossibleCasing !== null) {\n                advance(function () { cursor.continue(lowestPossibleCasing + nextKeySuffix); });\n            }\n            else {\n                advance(resolve);\n            }\n            return false;\n        }\n    });\n    return c;\n}\nfunction createRange(lower, upper, lowerOpen, upperOpen) {\n    return {\n        type: 2            ,\n        lower: lower,\n        upper: upper,\n        lowerOpen: lowerOpen,\n        upperOpen: upperOpen\n    };\n}\nfunction rangeEqual(value) {\n    return {\n        type: 1            ,\n        lower: value,\n        upper: value\n    };\n}\n\nvar WhereClause =               (function () {\n    function WhereClause() {\n    }\n    Object.defineProperty(WhereClause.prototype, \"Collection\", {\n        get: function () {\n            return this._ctx.table.db.Collection;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    WhereClause.prototype.between = function (lower, upper, includeLower, includeUpper) {\n        includeLower = includeLower !== false;\n        includeUpper = includeUpper === true;\n        try {\n            if ((this._cmp(lower, upper) > 0) ||\n                (this._cmp(lower, upper) === 0 && (includeLower || includeUpper) && !(includeLower && includeUpper)))\n                return emptyCollection(this);\n            return new this.Collection(this, function () { return createRange(lower, upper, !includeLower, !includeUpper); });\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n    };\n    WhereClause.prototype.equals = function (value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, function () { return rangeEqual(value); });\n    };\n    WhereClause.prototype.above = function (value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, function () { return createRange(value, undefined, true); });\n    };\n    WhereClause.prototype.aboveOrEqual = function (value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, function () { return createRange(value, undefined, false); });\n    };\n    WhereClause.prototype.below = function (value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, function () { return createRange(undefined, value, false, true); });\n    };\n    WhereClause.prototype.belowOrEqual = function (value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, function () { return createRange(undefined, value); });\n    };\n    WhereClause.prototype.startsWith = function (str) {\n        if (typeof str !== 'string')\n            return fail(this, STRING_EXPECTED);\n        return this.between(str, str + maxString, true, true);\n    };\n    WhereClause.prototype.startsWithIgnoreCase = function (str) {\n        if (str === \"\")\n            return this.startsWith(str);\n        return addIgnoreCaseAlgorithm(this, function (x, a) { return x.indexOf(a[0]) === 0; }, [str], maxString);\n    };\n    WhereClause.prototype.equalsIgnoreCase = function (str) {\n        return addIgnoreCaseAlgorithm(this, function (x, a) { return x === a[0]; }, [str], \"\");\n    };\n    WhereClause.prototype.anyOfIgnoreCase = function () {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, function (x, a) { return a.indexOf(x) !== -1; }, set, \"\");\n    };\n    WhereClause.prototype.startsWithAnyOfIgnoreCase = function () {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, function (x, a) { return a.some(function (n) { return x.indexOf(n) === 0; }); }, set, maxString);\n    };\n    WhereClause.prototype.anyOf = function () {\n        var _this = this;\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        var compare = this._cmp;\n        try {\n            set.sort(compare);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        var c = new this.Collection(this, function () { return createRange(set[0], set[set.length - 1]); });\n        c._ondirectionchange = function (direction) {\n            compare = (direction === \"next\" ?\n                _this._ascending :\n                _this._descending);\n            set.sort(compare);\n        };\n        var i = 0;\n        c._addAlgorithm(function (cursor, advance, resolve) {\n            var key = cursor.key;\n            while (compare(key, set[i]) > 0) {\n                ++i;\n                if (i === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (compare(key, set[i]) === 0) {\n                return true;\n            }\n            else {\n                advance(function () { cursor.continue(set[i]); });\n                return false;\n            }\n        });\n        return c;\n    };\n    WhereClause.prototype.notEqual = function (value) {\n        return this.inAnyRange([[minKey, value], [value, this.db._maxKey]], { includeLowers: false, includeUppers: false });\n    };\n    WhereClause.prototype.noneOf = function () {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return new this.Collection(this);\n        try {\n            set.sort(this._ascending);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        var ranges = set.reduce(function (res, val) { return res ?\n            res.concat([[res[res.length - 1][1], val]]) :\n            [[minKey, val]]; }, null);\n        ranges.push([set[set.length - 1], this.db._maxKey]);\n        return this.inAnyRange(ranges, { includeLowers: false, includeUppers: false });\n    };\n    WhereClause.prototype.inAnyRange = function (ranges, options) {\n        var _this = this;\n        var cmp = this._cmp, ascending = this._ascending, descending = this._descending, min = this._min, max = this._max;\n        if (ranges.length === 0)\n            return emptyCollection(this);\n        if (!ranges.every(function (range) {\n            return range[0] !== undefined &&\n                range[1] !== undefined &&\n                ascending(range[0], range[1]) <= 0;\n        })) {\n            return fail(this, \"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower\", exceptions.InvalidArgument);\n        }\n        var includeLowers = !options || options.includeLowers !== false;\n        var includeUppers = options && options.includeUppers === true;\n        function addRange(ranges, newRange) {\n            var i = 0, l = ranges.length;\n            for (; i < l; ++i) {\n                var range = ranges[i];\n                if (cmp(newRange[0], range[1]) < 0 && cmp(newRange[1], range[0]) > 0) {\n                    range[0] = min(range[0], newRange[0]);\n                    range[1] = max(range[1], newRange[1]);\n                    break;\n                }\n            }\n            if (i === l)\n                ranges.push(newRange);\n            return ranges;\n        }\n        var sortDirection = ascending;\n        function rangeSorter(a, b) { return sortDirection(a[0], b[0]); }\n        var set;\n        try {\n            set = ranges.reduce(addRange, []);\n            set.sort(rangeSorter);\n        }\n        catch (ex) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        var rangePos = 0;\n        var keyIsBeyondCurrentEntry = includeUppers ?\n            function (key) { return ascending(key, set[rangePos][1]) > 0; } :\n            function (key) { return ascending(key, set[rangePos][1]) >= 0; };\n        var keyIsBeforeCurrentEntry = includeLowers ?\n            function (key) { return descending(key, set[rangePos][0]) > 0; } :\n            function (key) { return descending(key, set[rangePos][0]) >= 0; };\n        function keyWithinCurrentRange(key) {\n            return !keyIsBeyondCurrentEntry(key) && !keyIsBeforeCurrentEntry(key);\n        }\n        var checkKey = keyIsBeyondCurrentEntry;\n        var c = new this.Collection(this, function () { return createRange(set[0][0], set[set.length - 1][1], !includeLowers, !includeUppers); });\n        c._ondirectionchange = function (direction) {\n            if (direction === \"next\") {\n                checkKey = keyIsBeyondCurrentEntry;\n                sortDirection = ascending;\n            }\n            else {\n                checkKey = keyIsBeforeCurrentEntry;\n                sortDirection = descending;\n            }\n            set.sort(rangeSorter);\n        };\n        c._addAlgorithm(function (cursor, advance, resolve) {\n            var key = cursor.key;\n            while (checkKey(key)) {\n                ++rangePos;\n                if (rangePos === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (keyWithinCurrentRange(key)) {\n                return true;\n            }\n            else if (_this._cmp(key, set[rangePos][1]) === 0 || _this._cmp(key, set[rangePos][0]) === 0) {\n                return false;\n            }\n            else {\n                advance(function () {\n                    if (sortDirection === ascending)\n                        cursor.continue(set[rangePos][0]);\n                    else\n                        cursor.continue(set[rangePos][1]);\n                });\n                return false;\n            }\n        });\n        return c;\n    };\n    WhereClause.prototype.startsWithAnyOf = function () {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (!set.every(function (s) { return typeof s === 'string'; })) {\n            return fail(this, \"startsWithAnyOf() only works with strings\");\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        return this.inAnyRange(set.map(function (str) { return [str, str + maxString]; }));\n    };\n    return WhereClause;\n}());\n\nfunction createWhereClauseConstructor(db) {\n    return makeClassConstructor(WhereClause.prototype, function WhereClause$$1(table, index, orCollection) {\n        this.db = db;\n        this._ctx = {\n            table: table,\n            index: index === \":id\" ? null : index,\n            or: orCollection\n        };\n        var indexedDB = db._deps.indexedDB;\n        if (!indexedDB)\n            throw new exceptions.MissingAPI(\"indexedDB API missing\");\n        this._cmp = this._ascending = indexedDB.cmp.bind(indexedDB);\n        this._descending = function (a, b) { return indexedDB.cmp(b, a); };\n        this._max = function (a, b) { return indexedDB.cmp(a, b) > 0 ? a : b; };\n        this._min = function (a, b) { return indexedDB.cmp(a, b) < 0 ? a : b; };\n        this._IDBKeyRange = db._deps.IDBKeyRange;\n    });\n}\n\nfunction safariMultiStoreFix(storeNames) {\n    return storeNames.length === 1 ? storeNames[0] : storeNames;\n}\n\nfunction getMaxKey(IdbKeyRange) {\n    try {\n        IdbKeyRange.only([[]]);\n        return [[]];\n    }\n    catch (e) {\n        return maxString;\n    }\n}\n\nfunction eventRejectHandler(reject) {\n    return wrap(function (event) {\n        preventDefault(event);\n        reject(event.target.error);\n        return false;\n    });\n}\n\n\n\nfunction preventDefault(event) {\n    if (event.stopPropagation)\n        event.stopPropagation();\n    if (event.preventDefault)\n        event.preventDefault();\n}\n\nvar Transaction =               (function () {\n    function Transaction() {\n    }\n    Transaction.prototype._lock = function () {\n        assert(!PSD.global);\n        ++this._reculock;\n        if (this._reculock === 1 && !PSD.global)\n            PSD.lockOwnerFor = this;\n        return this;\n    };\n    Transaction.prototype._unlock = function () {\n        assert(!PSD.global);\n        if (--this._reculock === 0) {\n            if (!PSD.global)\n                PSD.lockOwnerFor = null;\n            while (this._blockedFuncs.length > 0 && !this._locked()) {\n                var fnAndPSD = this._blockedFuncs.shift();\n                try {\n                    usePSD(fnAndPSD[1], fnAndPSD[0]);\n                }\n                catch (e) { }\n            }\n        }\n        return this;\n    };\n    Transaction.prototype._locked = function () {\n        return this._reculock && PSD.lockOwnerFor !== this;\n    };\n    Transaction.prototype.create = function (idbtrans) {\n        var _this = this;\n        if (!this.mode)\n            return this;\n        var idbdb = this.db.idbdb;\n        var dbOpenError = this.db._state.dbOpenError;\n        assert(!this.idbtrans);\n        if (!idbtrans && !idbdb) {\n            switch (dbOpenError && dbOpenError.name) {\n                case \"DatabaseClosedError\":\n                    throw new exceptions.DatabaseClosed(dbOpenError);\n                case \"MissingAPIError\":\n                    throw new exceptions.MissingAPI(dbOpenError.message, dbOpenError);\n                default:\n                    throw new exceptions.OpenFailed(dbOpenError);\n            }\n        }\n        if (!this.active)\n            throw new exceptions.TransactionInactive();\n        assert(this._completion._state === null);\n        idbtrans = this.idbtrans = idbtrans || idbdb.transaction(safariMultiStoreFix(this.storeNames), this.mode);\n        idbtrans.onerror = wrap(function (ev) {\n            preventDefault(ev);\n            _this._reject(idbtrans.error);\n        });\n        idbtrans.onabort = wrap(function (ev) {\n            preventDefault(ev);\n            _this.active && _this._reject(new exceptions.Abort(idbtrans.error));\n            _this.active = false;\n            _this.on(\"abort\").fire(ev);\n        });\n        idbtrans.oncomplete = wrap(function () {\n            _this.active = false;\n            _this._resolve();\n        });\n        return this;\n    };\n    Transaction.prototype._promise = function (mode, fn, bWriteLock) {\n        var _this = this;\n        if (mode === 'readwrite' && this.mode !== 'readwrite')\n            return rejection(new exceptions.ReadOnly(\"Transaction is readonly\"));\n        if (!this.active)\n            return rejection(new exceptions.TransactionInactive());\n        if (this._locked()) {\n            return new DexiePromise(function (resolve, reject) {\n                _this._blockedFuncs.push([function () {\n                        _this._promise(mode, fn, bWriteLock).then(resolve, reject);\n                    }, PSD]);\n            });\n        }\n        else if (bWriteLock) {\n            return newScope(function () {\n                var p = new DexiePromise(function (resolve, reject) {\n                    _this._lock();\n                    var rv = fn(resolve, reject, _this);\n                    if (rv && rv.then)\n                        rv.then(resolve, reject);\n                });\n                p.finally(function () { return _this._unlock(); });\n                p._lib = true;\n                return p;\n            });\n        }\n        else {\n            var p = new DexiePromise(function (resolve, reject) {\n                var rv = fn(resolve, reject, _this);\n                if (rv && rv.then)\n                    rv.then(resolve, reject);\n            });\n            p._lib = true;\n            return p;\n        }\n    };\n    Transaction.prototype._root = function () {\n        return this.parent ? this.parent._root() : this;\n    };\n    Transaction.prototype.waitFor = function (promiseLike) {\n        var root = this._root();\n        var promise = DexiePromise.resolve(promiseLike);\n        if (root._waitingFor) {\n            root._waitingFor = root._waitingFor.then(function () { return promise; });\n        }\n        else {\n            root._waitingFor = promise;\n            root._waitingQueue = [];\n            var store = root.idbtrans.objectStore(root.storeNames[0]);\n            (function spin() {\n                ++root._spinCount;\n                while (root._waitingQueue.length)\n                    (root._waitingQueue.shift())();\n                if (root._waitingFor)\n                    store.get(-Infinity).onsuccess = spin;\n            }());\n        }\n        var currentWaitPromise = root._waitingFor;\n        return new DexiePromise(function (resolve, reject) {\n            promise.then(function (res) { return root._waitingQueue.push(wrap(resolve.bind(null, res))); }, function (err) { return root._waitingQueue.push(wrap(reject.bind(null, err))); }).finally(function () {\n                if (root._waitingFor === currentWaitPromise) {\n                    root._waitingFor = null;\n                }\n            });\n        });\n    };\n    Transaction.prototype.abort = function () {\n        this.active && this._reject(new exceptions.Abort());\n        this.active = false;\n    };\n    Transaction.prototype.table = function (tableName) {\n        var memoizedTables = (this._memoizedTables || (this._memoizedTables = {}));\n        if (hasOwn(memoizedTables, tableName))\n            return memoizedTables[tableName];\n        var tableSchema = this.schema[tableName];\n        if (!tableSchema) {\n            throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n        }\n        var transactionBoundTable = new this.db.Table(tableName, tableSchema, this);\n        transactionBoundTable.core = this.db.core.table(tableName);\n        memoizedTables[tableName] = transactionBoundTable;\n        return transactionBoundTable;\n    };\n    return Transaction;\n}());\n\nfunction createTransactionConstructor(db) {\n    return makeClassConstructor(Transaction.prototype, function Transaction$$1(mode, storeNames, dbschema, parent) {\n        var _this = this;\n        this.db = db;\n        this.mode = mode;\n        this.storeNames = storeNames;\n        this.schema = dbschema;\n        this.idbtrans = null;\n        this.on = Events(this, \"complete\", \"error\", \"abort\");\n        this.parent = parent || null;\n        this.active = true;\n        this._reculock = 0;\n        this._blockedFuncs = [];\n        this._resolve = null;\n        this._reject = null;\n        this._waitingFor = null;\n        this._waitingQueue = null;\n        this._spinCount = 0;\n        this._completion = new DexiePromise(function (resolve, reject) {\n            _this._resolve = resolve;\n            _this._reject = reject;\n        });\n        this._completion.then(function () {\n            _this.active = false;\n            _this.on.complete.fire();\n        }, function (e) {\n            var wasActive = _this.active;\n            _this.active = false;\n            _this.on.error.fire(e);\n            _this.parent ?\n                _this.parent._reject(e) :\n                wasActive && _this.idbtrans && _this.idbtrans.abort();\n            return rejection(e);\n        });\n    });\n}\n\nfunction createIndexSpec(name, keyPath, unique, multi, auto, compound, isPrimKey) {\n    return {\n        name: name,\n        keyPath: keyPath,\n        unique: unique,\n        multi: multi,\n        auto: auto,\n        compound: compound,\n        src: (unique && !isPrimKey ? '&' : '') + (multi ? '*' : '') + (auto ? \"++\" : \"\") + nameFromKeyPath(keyPath)\n    };\n}\nfunction nameFromKeyPath(keyPath) {\n    return typeof keyPath === 'string' ?\n        keyPath :\n        keyPath ? ('[' + [].join.call(keyPath, '+') + ']') : \"\";\n}\n\nfunction createTableSchema(name, primKey, indexes) {\n    return {\n        name: name,\n        primKey: primKey,\n        indexes: indexes,\n        mappedClass: null,\n        idxByName: arrayToObject(indexes, function (index) { return [index.name, index]; })\n    };\n}\n\nfunction getKeyExtractor(keyPath) {\n    if (keyPath == null) {\n        return function () { return undefined; };\n    }\n    else if (typeof keyPath === 'string') {\n        return getSinglePathKeyExtractor(keyPath);\n    }\n    else {\n        return function (obj) { return getByKeyPath(obj, keyPath); };\n    }\n}\nfunction getSinglePathKeyExtractor(keyPath) {\n    var split = keyPath.split('.');\n    if (split.length === 1) {\n        return function (obj) { return obj[keyPath]; };\n    }\n    else {\n        return function (obj) { return getByKeyPath(obj, keyPath); };\n    }\n}\n\nfunction getEffectiveKeys(primaryKey, req) {\n    if (req.type === 'delete')\n        return req.keys;\n    return req.keys || req.values.map(primaryKey.extractKey);\n}\nfunction getExistingValues(table, req, effectiveKeys) {\n    return req.type === 'add' ? Promise.resolve(new Array(req.values.length)) :\n        table.getMany({ trans: req.trans, keys: effectiveKeys });\n}\n\nfunction arrayify(arrayLike) {\n    return [].slice.call(arrayLike);\n}\n\nvar _id_counter = 0;\nfunction getKeyPathAlias(keyPath) {\n    return keyPath == null ?\n        \":id\" :\n        typeof keyPath === 'string' ?\n            keyPath :\n            \"[\" + keyPath.join('+') + \"]\";\n}\nfunction createDBCore(db, indexedDB, IdbKeyRange, tmpTrans) {\n    var cmp = indexedDB.cmp.bind(indexedDB);\n    function extractSchema(db, trans) {\n        var tables = arrayify(db.objectStoreNames);\n        return {\n            schema: {\n                name: db.name,\n                tables: tables.map(function (table) { return trans.objectStore(table); }).map(function (store) {\n                    var keyPath = store.keyPath, autoIncrement = store.autoIncrement;\n                    var compound = isArray(keyPath);\n                    var outbound = keyPath == null;\n                    var indexByKeyPath = {};\n                    var result = {\n                        name: store.name,\n                        primaryKey: {\n                            name: null,\n                            isPrimaryKey: true,\n                            outbound: outbound,\n                            compound: compound,\n                            keyPath: keyPath,\n                            autoIncrement: autoIncrement,\n                            unique: true,\n                            extractKey: getKeyExtractor(keyPath)\n                        },\n                        indexes: arrayify(store.indexNames).map(function (indexName) { return store.index(indexName); })\n                            .map(function (index) {\n                            var name = index.name, unique = index.unique, multiEntry = index.multiEntry, keyPath = index.keyPath;\n                            var compound = isArray(keyPath);\n                            var result = {\n                                name: name,\n                                compound: compound,\n                                keyPath: keyPath,\n                                unique: unique,\n                                multiEntry: multiEntry,\n                                extractKey: getKeyExtractor(keyPath)\n                            };\n                            indexByKeyPath[getKeyPathAlias(keyPath)] = result;\n                            return result;\n                        }),\n                        getIndexByKeyPath: function (keyPath) { return indexByKeyPath[getKeyPathAlias(keyPath)]; }\n                    };\n                    indexByKeyPath[\":id\"] = result.primaryKey;\n                    if (keyPath != null) {\n                        indexByKeyPath[getKeyPathAlias(keyPath)] = result.primaryKey;\n                    }\n                    return result;\n                })\n            },\n            hasGetAll: tables.length > 0 && ('getAll' in trans.objectStore(tables[0])) &&\n                !(typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n                    !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n                    [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604)\n        };\n    }\n    function makeIDBKeyRange(range) {\n        if (range.type === 3          )\n            return null;\n        if (range.type === 4            )\n            throw new Error(\"Cannot convert never type to IDBKeyRange\");\n        var lower = range.lower, upper = range.upper, lowerOpen = range.lowerOpen, upperOpen = range.upperOpen;\n        var idbRange = lower === undefined ?\n            upper === undefined ?\n                null :\n                IdbKeyRange.upperBound(upper, !!upperOpen) :\n            upper === undefined ?\n                IdbKeyRange.lowerBound(lower, !!lowerOpen) :\n                IdbKeyRange.bound(lower, upper, !!lowerOpen, !!upperOpen);\n        return idbRange;\n    }\n    function createDbCoreTable(tableSchema) {\n        var tableName = tableSchema.name;\n        function mutate(_a) {\n            var trans = _a.trans, type = _a.type, keys$$1 = _a.keys, values = _a.values, range = _a.range, wantResults = _a.wantResults;\n            return new Promise(function (resolve, reject) {\n                resolve = wrap(resolve);\n                var store = trans.objectStore(tableName);\n                var outbound = store.keyPath == null;\n                var isAddOrPut = type === \"put\" || type === \"add\";\n                if (!isAddOrPut && type !== 'delete' && type !== 'deleteRange')\n                    throw new Error(\"Invalid operation type: \" + type);\n                var length = (keys$$1 || values || { length: 1 }).length;\n                if (keys$$1 && values && keys$$1.length !== values.length) {\n                    throw new Error(\"Given keys array must have same length as given values array.\");\n                }\n                if (length === 0)\n                    return resolve({ numFailures: 0, failures: {}, results: [], lastResult: undefined });\n                var results = wantResults && __spreadArrays((keys$$1 ?\n                    keys$$1 :\n                    getEffectiveKeys(tableSchema.primaryKey, { type: type, keys: keys$$1, values: values })));\n                var req;\n                var failures = [];\n                var numFailures = 0;\n                var errorHandler = function (event) {\n                    ++numFailures;\n                    preventDefault(event);\n                    if (results)\n                        results[event.target._reqno] = undefined;\n                    failures[event.target._reqno] = event.target.error;\n                };\n                var setResult = function (_a) {\n                    var target = _a.target;\n                    results[target._reqno] = target.result;\n                };\n                if (type === 'deleteRange') {\n                    if (range.type === 4            )\n                        return resolve({ numFailures: numFailures, failures: failures, results: results, lastResult: undefined });\n                    if (range.type === 3          )\n                        req = store.clear();\n                    else\n                        req = store.delete(makeIDBKeyRange(range));\n                }\n                else {\n                    var _a = isAddOrPut ?\n                        outbound ?\n                            [values, keys$$1] :\n                            [values, null] :\n                        [keys$$1, null], args1 = _a[0], args2 = _a[1];\n                    if (isAddOrPut) {\n                        for (var i = 0; i < length; ++i) {\n                            req = (args2 && args2[i] !== undefined ?\n                                store[type](args1[i], args2[i]) :\n                                store[type](args1[i]));\n                            req._reqno = i;\n                            if (results && results[i] === undefined) {\n                                req.onsuccess = setResult;\n                            }\n                            req.onerror = errorHandler;\n                        }\n                    }\n                    else {\n                        for (var i = 0; i < length; ++i) {\n                            req = store[type](args1[i]);\n                            req._reqno = i;\n                            req.onerror = errorHandler;\n                        }\n                    }\n                }\n                var done = function (event) {\n                    var lastResult = event.target.result;\n                    if (results)\n                        results[length - 1] = lastResult;\n                    resolve({\n                        numFailures: numFailures,\n                        failures: failures,\n                        results: results,\n                        lastResult: lastResult\n                    });\n                };\n                req.onerror = function (event) {\n                    errorHandler(event);\n                    done(event);\n                };\n                req.onsuccess = done;\n            });\n        }\n        function openCursor(_a) {\n            var trans = _a.trans, values = _a.values, query = _a.query, reverse = _a.reverse, unique = _a.unique;\n            return new Promise(function (resolve, reject) {\n                resolve = wrap(resolve);\n                var index = query.index, range = query.range;\n                var store = trans.objectStore(tableName);\n                var source = index.isPrimaryKey ?\n                    store :\n                    store.index(index.name);\n                var direction = reverse ?\n                    unique ?\n                        \"prevunique\" :\n                        \"prev\" :\n                    unique ?\n                        \"nextunique\" :\n                        \"next\";\n                var req = values || !('openKeyCursor' in source) ?\n                    source.openCursor(makeIDBKeyRange(range), direction) :\n                    source.openKeyCursor(makeIDBKeyRange(range), direction);\n                req.onerror = eventRejectHandler(reject);\n                req.onsuccess = wrap(function (ev) {\n                    var cursor = req.result;\n                    if (!cursor) {\n                        resolve(null);\n                        return;\n                    }\n                    cursor.___id = ++_id_counter;\n                    cursor.done = false;\n                    var _cursorContinue = cursor.continue.bind(cursor);\n                    var _cursorContinuePrimaryKey = cursor.continuePrimaryKey;\n                    if (_cursorContinuePrimaryKey)\n                        _cursorContinuePrimaryKey = _cursorContinuePrimaryKey.bind(cursor);\n                    var _cursorAdvance = cursor.advance.bind(cursor);\n                    var doThrowCursorIsNotStarted = function () { throw new Error(\"Cursor not started\"); };\n                    var doThrowCursorIsStopped = function () { throw new Error(\"Cursor not stopped\"); };\n                    cursor.trans = trans;\n                    cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsNotStarted;\n                    cursor.fail = wrap(reject);\n                    cursor.next = function () {\n                        var _this = this;\n                        var gotOne = 1;\n                        return this.start(function () { return gotOne-- ? _this.continue() : _this.stop(); }).then(function () { return _this; });\n                    };\n                    cursor.start = function (callback) {\n                        var iterationPromise = new Promise(function (resolveIteration, rejectIteration) {\n                            resolveIteration = wrap(resolveIteration);\n                            req.onerror = eventRejectHandler(rejectIteration);\n                            cursor.fail = rejectIteration;\n                            cursor.stop = function (value) {\n                                cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsStopped;\n                                resolveIteration(value);\n                            };\n                        });\n                        var guardedCallback = function () {\n                            if (req.result) {\n                                try {\n                                    callback();\n                                }\n                                catch (err) {\n                                    cursor.fail(err);\n                                }\n                            }\n                            else {\n                                cursor.done = true;\n                                cursor.start = function () { throw new Error(\"Cursor behind last entry\"); };\n                                cursor.stop();\n                            }\n                        };\n                        req.onsuccess = wrap(function (ev) {\n                            req.onsuccess = guardedCallback;\n                            guardedCallback();\n                        });\n                        cursor.continue = _cursorContinue;\n                        cursor.continuePrimaryKey = _cursorContinuePrimaryKey;\n                        cursor.advance = _cursorAdvance;\n                        guardedCallback();\n                        return iterationPromise;\n                    };\n                    resolve(cursor);\n                }, reject);\n            });\n        }\n        function query(hasGetAll) {\n            return function (request) {\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var trans = request.trans, values = request.values, limit = request.limit, query = request.query;\n                    var nonInfinitLimit = limit === Infinity ? undefined : limit;\n                    var index = query.index, range = query.range;\n                    var store = trans.objectStore(tableName);\n                    var source = index.isPrimaryKey ? store : store.index(index.name);\n                    var idbKeyRange = makeIDBKeyRange(range);\n                    if (limit === 0)\n                        return resolve({ result: [] });\n                    if (hasGetAll) {\n                        var req = values ?\n                            source.getAll(idbKeyRange, nonInfinitLimit) :\n                            source.getAllKeys(idbKeyRange, nonInfinitLimit);\n                        req.onsuccess = function (event) { return resolve({ result: event.target.result }); };\n                        req.onerror = eventRejectHandler(reject);\n                    }\n                    else {\n                        var count_1 = 0;\n                        var req_1 = values || !('openKeyCursor' in source) ?\n                            source.openCursor(idbKeyRange) :\n                            source.openKeyCursor(idbKeyRange);\n                        var result_1 = [];\n                        req_1.onsuccess = function (event) {\n                            var cursor = req_1.result;\n                            if (!cursor)\n                                return resolve({ result: result_1 });\n                            result_1.push(values ? cursor.value : cursor.primaryKey);\n                            if (++count_1 === limit)\n                                return resolve({ result: result_1 });\n                            cursor.continue();\n                        };\n                        req_1.onerror = eventRejectHandler(reject);\n                    }\n                });\n            };\n        }\n        return {\n            name: tableName,\n            schema: tableSchema,\n            mutate: mutate,\n            getMany: function (_a) {\n                var trans = _a.trans, keys$$1 = _a.keys;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var store = trans.objectStore(tableName);\n                    var length = keys$$1.length;\n                    var result = new Array(length);\n                    var keyCount = 0;\n                    var callbackCount = 0;\n                    var valueCount = 0;\n                    var req;\n                    var successHandler = function (event) {\n                        var req = event.target;\n                        if ((result[req._pos] = req.result) != null)\n                            ++valueCount;\n                        if (++callbackCount === keyCount)\n                            resolve(result);\n                    };\n                    var errorHandler = eventRejectHandler(reject);\n                    for (var i = 0; i < length; ++i) {\n                        var key = keys$$1[i];\n                        if (key != null) {\n                            req = store.get(keys$$1[i]);\n                            req._pos = i;\n                            req.onsuccess = successHandler;\n                            req.onerror = errorHandler;\n                            ++keyCount;\n                        }\n                    }\n                    if (keyCount === 0)\n                        resolve(result);\n                });\n            },\n            get: function (_a) {\n                var trans = _a.trans, key = _a.key;\n                return new Promise(function (resolve, reject) {\n                    resolve = wrap(resolve);\n                    var store = trans.objectStore(tableName);\n                    var req = store.get(key);\n                    req.onsuccess = function (event) { return resolve(event.target.result); };\n                    req.onerror = eventRejectHandler(reject);\n                });\n            },\n            query: query(hasGetAll),\n            openCursor: openCursor,\n            count: function (_a) {\n                var query = _a.query, trans = _a.trans;\n                var index = query.index, range = query.range;\n                return new Promise(function (resolve, reject) {\n                    var store = trans.objectStore(tableName);\n                    var source = index.isPrimaryKey ? store : store.index(index.name);\n                    var idbKeyRange = makeIDBKeyRange(range);\n                    var req = idbKeyRange ? source.count(idbKeyRange) : source.count();\n                    req.onsuccess = wrap(function (ev) { return resolve(ev.target.result); });\n                    req.onerror = eventRejectHandler(reject);\n                });\n            }\n        };\n    }\n    var _a = extractSchema(db, tmpTrans), schema = _a.schema, hasGetAll = _a.hasGetAll;\n    var tables = schema.tables.map(function (tableSchema) { return createDbCoreTable(tableSchema); });\n    var tableMap = {};\n    tables.forEach(function (table) { return tableMap[table.name] = table; });\n    return {\n        stack: \"dbcore\",\n        transaction: db.transaction.bind(db),\n        table: function (name) {\n            var result = tableMap[name];\n            if (!result)\n                throw new Error(\"Table '\" + name + \"' not found\");\n            return tableMap[name];\n        },\n        cmp: cmp,\n        MIN_KEY: -Infinity,\n        MAX_KEY: getMaxKey(IdbKeyRange),\n        schema: schema\n    };\n}\n\nfunction createMiddlewareStack(stackImpl, middlewares) {\n    return middlewares.reduce(function (down, _a) {\n        var create = _a.create;\n        return (__assign(__assign({}, down), create(down)));\n    }, stackImpl);\n}\nfunction createMiddlewareStacks(middlewares, idbdb, _a, tmpTrans) {\n    var IDBKeyRange = _a.IDBKeyRange, indexedDB = _a.indexedDB;\n    var dbcore = createMiddlewareStack(createDBCore(idbdb, indexedDB, IDBKeyRange, tmpTrans), middlewares.dbcore);\n    return {\n        dbcore: dbcore\n    };\n}\nfunction generateMiddlewareStacks(db, tmpTrans) {\n    var idbdb = tmpTrans.db;\n    var stacks = createMiddlewareStacks(db._middlewares, idbdb, db._deps, tmpTrans);\n    db.core = stacks.dbcore;\n    db.tables.forEach(function (table) {\n        var tableName = table.name;\n        if (db.core.schema.tables.some(function (tbl) { return tbl.name === tableName; })) {\n            table.core = db.core.table(tableName);\n            if (db[tableName] instanceof db.Table) {\n                db[tableName].core = table.core;\n            }\n        }\n    });\n}\n\nfunction setApiOnPlace(db, objs, tableNames, dbschema) {\n    tableNames.forEach(function (tableName) {\n        var schema = dbschema[tableName];\n        objs.forEach(function (obj) {\n            var propDesc = getPropertyDescriptor(obj, tableName);\n            if (!propDesc || (\"value\" in propDesc && propDesc.value === undefined)) {\n                if (obj === db.Transaction.prototype || obj instanceof db.Transaction) {\n                    setProp(obj, tableName, {\n                        get: function () { return this.table(tableName); },\n                        set: function (value) {\n                            defineProperty(this, tableName, { value: value, writable: true, configurable: true, enumerable: true });\n                        }\n                    });\n                }\n                else {\n                    obj[tableName] = new db.Table(tableName, schema);\n                }\n            }\n        });\n    });\n}\nfunction removeTablesApi(db, objs) {\n    objs.forEach(function (obj) {\n        for (var key in obj) {\n            if (obj[key] instanceof db.Table)\n                delete obj[key];\n        }\n    });\n}\nfunction lowerVersionFirst(a, b) {\n    return a._cfg.version - b._cfg.version;\n}\nfunction runUpgraders(db, oldVersion, idbUpgradeTrans, reject) {\n    var globalSchema = db._dbSchema;\n    var trans = db._createTransaction('readwrite', db._storeNames, globalSchema);\n    trans.create(idbUpgradeTrans);\n    trans._completion.catch(reject);\n    var rejectTransaction = trans._reject.bind(trans);\n    var transless = PSD.transless || PSD;\n    newScope(function () {\n        PSD.trans = trans;\n        PSD.transless = transless;\n        if (oldVersion === 0) {\n            keys(globalSchema).forEach(function (tableName) {\n                createTable(idbUpgradeTrans, tableName, globalSchema[tableName].primKey, globalSchema[tableName].indexes);\n            });\n            generateMiddlewareStacks(db, idbUpgradeTrans);\n            DexiePromise.follow(function () { return db.on.populate.fire(trans); }).catch(rejectTransaction);\n        }\n        else\n            updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans).catch(rejectTransaction);\n    });\n}\nfunction updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans) {\n    var queue = [];\n    var versions = db._versions;\n    var globalSchema = db._dbSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n    var anyContentUpgraderHasRun = false;\n    var versToRun = versions.filter(function (v) { return v._cfg.version >= oldVersion; });\n    versToRun.forEach(function (version) {\n        queue.push(function () {\n            var oldSchema = globalSchema;\n            var newSchema = version._cfg.dbschema;\n            adjustToExistingIndexNames(db, oldSchema, idbUpgradeTrans);\n            adjustToExistingIndexNames(db, newSchema, idbUpgradeTrans);\n            globalSchema = db._dbSchema = newSchema;\n            var diff = getSchemaDiff(oldSchema, newSchema);\n            diff.add.forEach(function (tuple) {\n                createTable(idbUpgradeTrans, tuple[0], tuple[1].primKey, tuple[1].indexes);\n            });\n            diff.change.forEach(function (change) {\n                if (change.recreate) {\n                    throw new exceptions.Upgrade(\"Not yet support for changing primary key\");\n                }\n                else {\n                    var store_1 = idbUpgradeTrans.objectStore(change.name);\n                    change.add.forEach(function (idx) { return addIndex(store_1, idx); });\n                    change.change.forEach(function (idx) {\n                        store_1.deleteIndex(idx.name);\n                        addIndex(store_1, idx);\n                    });\n                    change.del.forEach(function (idxName) { return store_1.deleteIndex(idxName); });\n                }\n            });\n            var contentUpgrade = version._cfg.contentUpgrade;\n            if (contentUpgrade && version._cfg.version > oldVersion) {\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                trans._memoizedTables = {};\n                anyContentUpgraderHasRun = true;\n                var upgradeSchema_1 = shallowClone(newSchema);\n                diff.del.forEach(function (table) {\n                    upgradeSchema_1[table] = oldSchema[table];\n                });\n                removeTablesApi(db, [db.Transaction.prototype]);\n                setApiOnPlace(db, [db.Transaction.prototype], keys(upgradeSchema_1), upgradeSchema_1);\n                trans.schema = upgradeSchema_1;\n                var contentUpgradeIsAsync_1 = isAsyncFunction(contentUpgrade);\n                if (contentUpgradeIsAsync_1) {\n                    incrementExpectedAwaits();\n                }\n                var returnValue_1;\n                var promiseFollowed = DexiePromise.follow(function () {\n                    returnValue_1 = contentUpgrade(trans);\n                    if (returnValue_1) {\n                        if (contentUpgradeIsAsync_1) {\n                            var decrementor = decrementExpectedAwaits.bind(null, null);\n                            returnValue_1.then(decrementor, decrementor);\n                        }\n                    }\n                });\n                return (returnValue_1 && typeof returnValue_1.then === 'function' ?\n                    DexiePromise.resolve(returnValue_1) : promiseFollowed.then(function () { return returnValue_1; }));\n            }\n        });\n        queue.push(function (idbtrans) {\n            if (!anyContentUpgraderHasRun || !hasIEDeleteObjectStoreBug) {\n                var newSchema = version._cfg.dbschema;\n                deleteRemovedTables(newSchema, idbtrans);\n            }\n            removeTablesApi(db, [db.Transaction.prototype]);\n            setApiOnPlace(db, [db.Transaction.prototype], db._storeNames, db._dbSchema);\n            trans.schema = db._dbSchema;\n        });\n    });\n    function runQueue() {\n        return queue.length ? DexiePromise.resolve(queue.shift()(trans.idbtrans)).then(runQueue) :\n            DexiePromise.resolve();\n    }\n    return runQueue().then(function () {\n        createMissingTables(globalSchema, idbUpgradeTrans);\n    });\n}\nfunction getSchemaDiff(oldSchema, newSchema) {\n    var diff = {\n        del: [],\n        add: [],\n        change: []\n    };\n    var table;\n    for (table in oldSchema) {\n        if (!newSchema[table])\n            diff.del.push(table);\n    }\n    for (table in newSchema) {\n        var oldDef = oldSchema[table], newDef = newSchema[table];\n        if (!oldDef) {\n            diff.add.push([table, newDef]);\n        }\n        else {\n            var change = {\n                name: table,\n                def: newDef,\n                recreate: false,\n                del: [],\n                add: [],\n                change: []\n            };\n            if ((\n            '' + (oldDef.primKey.keyPath || '')) !== ('' + (newDef.primKey.keyPath || '')) ||\n                (oldDef.primKey.auto !== newDef.primKey.auto && !isIEOrEdge))\n             {\n                change.recreate = true;\n                diff.change.push(change);\n            }\n            else {\n                var oldIndexes = oldDef.idxByName;\n                var newIndexes = newDef.idxByName;\n                var idxName = void 0;\n                for (idxName in oldIndexes) {\n                    if (!newIndexes[idxName])\n                        change.del.push(idxName);\n                }\n                for (idxName in newIndexes) {\n                    var oldIdx = oldIndexes[idxName], newIdx = newIndexes[idxName];\n                    if (!oldIdx)\n                        change.add.push(newIdx);\n                    else if (oldIdx.src !== newIdx.src)\n                        change.change.push(newIdx);\n                }\n                if (change.del.length > 0 || change.add.length > 0 || change.change.length > 0) {\n                    diff.change.push(change);\n                }\n            }\n        }\n    }\n    return diff;\n}\nfunction createTable(idbtrans, tableName, primKey, indexes) {\n    var store = idbtrans.db.createObjectStore(tableName, primKey.keyPath ?\n        { keyPath: primKey.keyPath, autoIncrement: primKey.auto } :\n        { autoIncrement: primKey.auto });\n    indexes.forEach(function (idx) { return addIndex(store, idx); });\n    return store;\n}\nfunction createMissingTables(newSchema, idbtrans) {\n    keys(newSchema).forEach(function (tableName) {\n        if (!idbtrans.db.objectStoreNames.contains(tableName)) {\n            createTable(idbtrans, tableName, newSchema[tableName].primKey, newSchema[tableName].indexes);\n        }\n    });\n}\nfunction deleteRemovedTables(newSchema, idbtrans) {\n    for (var i = 0; i < idbtrans.db.objectStoreNames.length; ++i) {\n        var storeName = idbtrans.db.objectStoreNames[i];\n        if (newSchema[storeName] == null) {\n            idbtrans.db.deleteObjectStore(storeName);\n        }\n    }\n}\nfunction addIndex(store, idx) {\n    store.createIndex(idx.name, idx.keyPath, { unique: idx.unique, multiEntry: idx.multi });\n}\nfunction buildGlobalSchema(db, idbdb, tmpTrans) {\n    var globalSchema = {};\n    var dbStoreNames = slice(idbdb.objectStoreNames, 0);\n    dbStoreNames.forEach(function (storeName) {\n        var store = tmpTrans.objectStore(storeName);\n        var keyPath = store.keyPath;\n        var primKey = createIndexSpec(nameFromKeyPath(keyPath), keyPath || \"\", false, false, !!store.autoIncrement, keyPath && typeof keyPath !== \"string\", true);\n        var indexes = [];\n        for (var j = 0; j < store.indexNames.length; ++j) {\n            var idbindex = store.index(store.indexNames[j]);\n            keyPath = idbindex.keyPath;\n            var index = createIndexSpec(idbindex.name, keyPath, !!idbindex.unique, !!idbindex.multiEntry, false, keyPath && typeof keyPath !== \"string\", false);\n            indexes.push(index);\n        }\n        globalSchema[storeName] = createTableSchema(storeName, primKey, indexes);\n    });\n    return globalSchema;\n}\nfunction readGlobalSchema(db, idbdb, tmpTrans) {\n    db.verno = idbdb.version / 10;\n    var globalSchema = db._dbSchema = buildGlobalSchema(db, idbdb, tmpTrans);\n    db._storeNames = slice(idbdb.objectStoreNames, 0);\n    setApiOnPlace(db, [db._allTables], keys(globalSchema), globalSchema);\n}\nfunction verifyInstalledSchema(db, tmpTrans) {\n    var installedSchema = buildGlobalSchema(db, db.idbdb, tmpTrans);\n    var diff = getSchemaDiff(installedSchema, db._dbSchema);\n    return !(diff.add.length || diff.change.some(function (ch) { return ch.add.length || ch.change.length; }));\n}\nfunction adjustToExistingIndexNames(db, schema, idbtrans) {\n    var storeNames = idbtrans.db.objectStoreNames;\n    for (var i = 0; i < storeNames.length; ++i) {\n        var storeName = storeNames[i];\n        var store = idbtrans.objectStore(storeName);\n        db._hasGetAll = 'getAll' in store;\n        for (var j = 0; j < store.indexNames.length; ++j) {\n            var indexName = store.indexNames[j];\n            var keyPath = store.index(indexName).keyPath;\n            var dexieName = typeof keyPath === 'string' ? keyPath : \"[\" + slice(keyPath).join('+') + \"]\";\n            if (schema[storeName]) {\n                var indexSpec = schema[storeName].idxByName[dexieName];\n                if (indexSpec) {\n                    indexSpec.name = indexName;\n                    delete schema[storeName].idxByName[dexieName];\n                    schema[storeName].idxByName[indexName] = indexSpec;\n                }\n            }\n        }\n    }\n    if (typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n        !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n        _global.WorkerGlobalScope && _global instanceof _global.WorkerGlobalScope &&\n        [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604) {\n        db._hasGetAll = false;\n    }\n}\nfunction parseIndexSyntax(primKeyAndIndexes) {\n    return primKeyAndIndexes.split(',').map(function (index, indexNum) {\n        index = index.trim();\n        var name = index.replace(/([&*]|\\+\\+)/g, \"\");\n        var keyPath = /^\\[/.test(name) ? name.match(/^\\[(.*)\\]$/)[1].split('+') : name;\n        return createIndexSpec(name, keyPath || null, /\\&/.test(index), /\\*/.test(index), /\\+\\+/.test(index), isArray(keyPath), indexNum === 0);\n    });\n}\n\nvar Version =               (function () {\n    function Version() {\n    }\n    Version.prototype._parseStoresSpec = function (stores, outSchema) {\n        keys(stores).forEach(function (tableName) {\n            if (stores[tableName] !== null) {\n                var indexes = parseIndexSyntax(stores[tableName]);\n                var primKey = indexes.shift();\n                if (primKey.multi)\n                    throw new exceptions.Schema(\"Primary key cannot be multi-valued\");\n                indexes.forEach(function (idx) {\n                    if (idx.auto)\n                        throw new exceptions.Schema(\"Only primary key can be marked as autoIncrement (++)\");\n                    if (!idx.keyPath)\n                        throw new exceptions.Schema(\"Index must have a name and cannot be an empty string\");\n                });\n                outSchema[tableName] = createTableSchema(tableName, primKey, indexes);\n            }\n        });\n    };\n    Version.prototype.stores = function (stores) {\n        var db = this.db;\n        this._cfg.storesSource = this._cfg.storesSource ?\n            extend(this._cfg.storesSource, stores) :\n            stores;\n        var versions = db._versions;\n        var storesSpec = {};\n        var dbschema = {};\n        versions.forEach(function (version) {\n            extend(storesSpec, version._cfg.storesSource);\n            dbschema = (version._cfg.dbschema = {});\n            version._parseStoresSpec(storesSpec, dbschema);\n        });\n        db._dbSchema = dbschema;\n        removeTablesApi(db, [db._allTables, db, db.Transaction.prototype]);\n        setApiOnPlace(db, [db._allTables, db, db.Transaction.prototype, this._cfg.tables], keys(dbschema), dbschema);\n        db._storeNames = keys(dbschema);\n        return this;\n    };\n    Version.prototype.upgrade = function (upgradeFunction) {\n        this._cfg.contentUpgrade = upgradeFunction;\n        return this;\n    };\n    return Version;\n}());\n\nfunction createVersionConstructor(db) {\n    return makeClassConstructor(Version.prototype, function Version$$1(versionNumber) {\n        this.db = db;\n        this._cfg = {\n            version: versionNumber,\n            storesSource: null,\n            dbschema: {},\n            tables: {},\n            contentUpgrade: null\n        };\n    });\n}\n\nvar databaseEnumerator;\nfunction DatabaseEnumerator(indexedDB) {\n    var hasDatabasesNative = indexedDB && typeof indexedDB.databases === 'function';\n    var dbNamesTable;\n    if (!hasDatabasesNative) {\n        var db = new Dexie(DBNAMES_DB, { addons: [] });\n        db.version(1).stores({ dbnames: 'name' });\n        dbNamesTable = db.table('dbnames');\n    }\n    return {\n        getDatabaseNames: function () {\n            return hasDatabasesNative\n                ?\n                    DexiePromise.resolve(indexedDB.databases()).then(function (infos) { return infos\n                        .map(function (info) { return info.name; })\n                        .filter(function (name) { return name !== DBNAMES_DB; }); })\n                :\n                    dbNamesTable.toCollection().primaryKeys();\n        },\n        add: function (name) {\n            return !hasDatabasesNative && name !== DBNAMES_DB && dbNamesTable.put({ name: name }).catch(nop);\n        },\n        remove: function (name) {\n            return !hasDatabasesNative && name !== DBNAMES_DB && dbNamesTable.delete(name).catch(nop);\n        }\n    };\n}\nfunction initDatabaseEnumerator(indexedDB) {\n    try {\n        databaseEnumerator = DatabaseEnumerator(indexedDB);\n    }\n    catch (e) { }\n}\n\nfunction vip(fn) {\n    return newScope(function () {\n        PSD.letThrough = true;\n        return fn();\n    });\n}\n\nfunction dexieOpen(db) {\n    var state = db._state;\n    var indexedDB = db._deps.indexedDB;\n    if (state.isBeingOpened || db.idbdb)\n        return state.dbReadyPromise.then(function () { return state.dbOpenError ?\n            rejection(state.dbOpenError) :\n            db; });\n    debug && (state.openCanceller._stackHolder = getErrorWithStack());\n    state.isBeingOpened = true;\n    state.dbOpenError = null;\n    state.openComplete = false;\n    var resolveDbReady = state.dbReadyResolve,\n    upgradeTransaction = null;\n    return DexiePromise.race([state.openCanceller, new DexiePromise(function (resolve, reject) {\n            if (!indexedDB)\n                throw new exceptions.MissingAPI(\"indexedDB API not found. If using IE10+, make sure to run your code on a server URL \" +\n                    \"(not locally). If using old Safari versions, make sure to include indexedDB polyfill.\");\n            var dbName = db.name;\n            var req = state.autoSchema ?\n                indexedDB.open(dbName) :\n                indexedDB.open(dbName, Math.round(db.verno * 10));\n            if (!req)\n                throw new exceptions.MissingAPI(\"IndexedDB API not available\");\n            req.onerror = eventRejectHandler(reject);\n            req.onblocked = wrap(db._fireOnBlocked);\n            req.onupgradeneeded = wrap(function (e) {\n                upgradeTransaction = req.transaction;\n                if (state.autoSchema && !db._options.allowEmptyDB) {\n                    req.onerror = preventDefault;\n                    upgradeTransaction.abort();\n                    req.result.close();\n                    var delreq = indexedDB.deleteDatabase(dbName);\n                    delreq.onsuccess = delreq.onerror = wrap(function () {\n                        reject(new exceptions.NoSuchDatabase(\"Database \" + dbName + \" doesnt exist\"));\n                    });\n                }\n                else {\n                    upgradeTransaction.onerror = eventRejectHandler(reject);\n                    var oldVer = e.oldVersion > Math.pow(2, 62) ? 0 : e.oldVersion;\n                    db.idbdb = req.result;\n                    runUpgraders(db, oldVer / 10, upgradeTransaction, reject);\n                }\n            }, reject);\n            req.onsuccess = wrap(function () {\n                upgradeTransaction = null;\n                var idbdb = db.idbdb = req.result;\n                var objectStoreNames = slice(idbdb.objectStoreNames);\n                if (objectStoreNames.length > 0)\n                    try {\n                        var tmpTrans = idbdb.transaction(safariMultiStoreFix(objectStoreNames), 'readonly');\n                        if (state.autoSchema)\n                            readGlobalSchema(db, idbdb, tmpTrans);\n                        else {\n                            adjustToExistingIndexNames(db, db._dbSchema, tmpTrans);\n                            if (!verifyInstalledSchema(db, tmpTrans)) {\n                                console.warn(\"Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.\");\n                            }\n                        }\n                        generateMiddlewareStacks(db, tmpTrans);\n                    }\n                    catch (e) {\n                    }\n                connections.push(db);\n                idbdb.onversionchange = wrap(function (ev) {\n                    state.vcFired = true;\n                    db.on(\"versionchange\").fire(ev);\n                });\n                databaseEnumerator.add(dbName);\n                resolve();\n            }, reject);\n        })]).then(function () {\n        state.onReadyBeingFired = [];\n        return DexiePromise.resolve(vip(db.on.ready.fire)).then(function fireRemainders() {\n            if (state.onReadyBeingFired.length > 0) {\n                var remainders = state.onReadyBeingFired.reduce(promisableChain, nop);\n                state.onReadyBeingFired = [];\n                return DexiePromise.resolve(vip(remainders)).then(fireRemainders);\n            }\n        });\n    }).finally(function () {\n        state.onReadyBeingFired = null;\n    }).then(function () {\n        state.isBeingOpened = false;\n        return db;\n    }).catch(function (err) {\n        try {\n            upgradeTransaction && upgradeTransaction.abort();\n        }\n        catch (e) { }\n        state.isBeingOpened = false;\n        db.close();\n        state.dbOpenError = err;\n        return rejection(state.dbOpenError);\n    }).finally(function () {\n        state.openComplete = true;\n        resolveDbReady();\n    });\n}\n\nfunction awaitIterator(iterator) {\n    var callNext = function (result) { return iterator.next(result); }, doThrow = function (error) { return iterator.throw(error); }, onSuccess = step(callNext), onError = step(doThrow);\n    function step(getNext) {\n        return function (val) {\n            var next = getNext(val), value = next.value;\n            return next.done ? value :\n                (!value || typeof value.then !== 'function' ?\n                    isArray(value) ? Promise.all(value).then(onSuccess, onError) : onSuccess(value) :\n                    value.then(onSuccess, onError));\n        };\n    }\n    return step(callNext)();\n}\n\nfunction extractTransactionArgs(mode, _tableArgs_, scopeFunc) {\n    var i = arguments.length;\n    if (i < 2)\n        throw new exceptions.InvalidArgument(\"Too few arguments\");\n    var args = new Array(i - 1);\n    while (--i)\n        args[i - 1] = arguments[i];\n    scopeFunc = args.pop();\n    var tables = flatten(args);\n    return [mode, tables, scopeFunc];\n}\nfunction enterTransactionScope(db, mode, storeNames, parentTransaction, scopeFunc) {\n    return DexiePromise.resolve().then(function () {\n        var transless = PSD.transless || PSD;\n        var trans = db._createTransaction(mode, storeNames, db._dbSchema, parentTransaction);\n        var zoneProps = {\n            trans: trans,\n            transless: transless\n        };\n        if (parentTransaction) {\n            trans.idbtrans = parentTransaction.idbtrans;\n        }\n        else {\n            trans.create();\n        }\n        var scopeFuncIsAsync = isAsyncFunction(scopeFunc);\n        if (scopeFuncIsAsync) {\n            incrementExpectedAwaits();\n        }\n        var returnValue;\n        var promiseFollowed = DexiePromise.follow(function () {\n            returnValue = scopeFunc.call(trans, trans);\n            if (returnValue) {\n                if (scopeFuncIsAsync) {\n                    var decrementor = decrementExpectedAwaits.bind(null, null);\n                    returnValue.then(decrementor, decrementor);\n                }\n                else if (typeof returnValue.next === 'function' && typeof returnValue.throw === 'function') {\n                    returnValue = awaitIterator(returnValue);\n                }\n            }\n        }, zoneProps);\n        return (returnValue && typeof returnValue.then === 'function' ?\n            DexiePromise.resolve(returnValue).then(function (x) { return trans.active ?\n                x\n                : rejection(new exceptions.PrematureCommit(\"Transaction committed too early. See http://bit.ly/2kdckMn\")); })\n            : promiseFollowed.then(function () { return returnValue; })).then(function (x) {\n            if (parentTransaction)\n                trans._resolve();\n            return trans._completion.then(function () { return x; });\n        }).catch(function (e) {\n            trans._reject(e);\n            return rejection(e);\n        });\n    });\n}\n\nfunction pad(a, value, count) {\n    var result = isArray(a) ? a.slice() : [a];\n    for (var i = 0; i < count; ++i)\n        result.push(value);\n    return result;\n}\nfunction createVirtualIndexMiddleware(down) {\n    return __assign(__assign({}, down), { table: function (tableName) {\n            var table = down.table(tableName);\n            var schema = table.schema;\n            var indexLookup = {};\n            var allVirtualIndexes = [];\n            function addVirtualIndexes(keyPath, keyTail, lowLevelIndex) {\n                var keyPathAlias = getKeyPathAlias(keyPath);\n                var indexList = (indexLookup[keyPathAlias] = indexLookup[keyPathAlias] || []);\n                var keyLength = keyPath == null ? 0 : typeof keyPath === 'string' ? 1 : keyPath.length;\n                var isVirtual = keyTail > 0;\n                var virtualIndex = __assign(__assign({}, lowLevelIndex), { isVirtual: isVirtual, isPrimaryKey: !isVirtual && lowLevelIndex.isPrimaryKey, keyTail: keyTail,\n                    keyLength: keyLength, extractKey: getKeyExtractor(keyPath), unique: !isVirtual && lowLevelIndex.unique });\n                indexList.push(virtualIndex);\n                if (!virtualIndex.isPrimaryKey) {\n                    allVirtualIndexes.push(virtualIndex);\n                }\n                if (keyLength > 1) {\n                    var virtualKeyPath = keyLength === 2 ?\n                        keyPath[0] :\n                        keyPath.slice(0, keyLength - 1);\n                    addVirtualIndexes(virtualKeyPath, keyTail + 1, lowLevelIndex);\n                }\n                indexList.sort(function (a, b) { return a.keyTail - b.keyTail; });\n                return virtualIndex;\n            }\n            var primaryKey = addVirtualIndexes(schema.primaryKey.keyPath, 0, schema.primaryKey);\n            indexLookup[\":id\"] = [primaryKey];\n            for (var _i = 0, _a = schema.indexes; _i < _a.length; _i++) {\n                var index = _a[_i];\n                addVirtualIndexes(index.keyPath, 0, index);\n            }\n            function findBestIndex(keyPath) {\n                var result = indexLookup[getKeyPathAlias(keyPath)];\n                return result && result[0];\n            }\n            function translateRange(range, keyTail) {\n                return {\n                    type: range.type === 1             ?\n                        2             :\n                        range.type,\n                    lower: pad(range.lower, range.lowerOpen ? down.MAX_KEY : down.MIN_KEY, keyTail),\n                    lowerOpen: true,\n                    upper: pad(range.upper, range.upperOpen ? down.MIN_KEY : down.MAX_KEY, keyTail),\n                    upperOpen: true\n                };\n            }\n            function translateRequest(req) {\n                var index = req.query.index;\n                return index.isVirtual ? __assign(__assign({}, req), { query: {\n                        index: index,\n                        range: translateRange(req.query.range, index.keyTail)\n                    } }) : req;\n            }\n            var result = __assign(__assign({}, table), { schema: __assign(__assign({}, schema), { primaryKey: primaryKey, indexes: allVirtualIndexes, getIndexByKeyPath: findBestIndex }), count: function (req) {\n                    return table.count(translateRequest(req));\n                },\n                query: function (req) {\n                    return table.query(translateRequest(req));\n                },\n                openCursor: function (req) {\n                    var _a = req.query.index, keyTail = _a.keyTail, isVirtual = _a.isVirtual, keyLength = _a.keyLength;\n                    if (!isVirtual)\n                        return table.openCursor(req);\n                    function createVirtualCursor(cursor) {\n                        function _continue(key) {\n                            key != null ?\n                                cursor.continue(pad(key, req.reverse ? down.MAX_KEY : down.MIN_KEY, keyTail)) :\n                                req.unique ?\n                                    cursor.continue(pad(cursor.key, req.reverse ? down.MIN_KEY : down.MAX_KEY, keyTail)) :\n                                    cursor.continue();\n                        }\n                        var virtualCursor = Object.create(cursor, {\n                            continue: { value: _continue },\n                            continuePrimaryKey: {\n                                value: function (key, primaryKey) {\n                                    cursor.continuePrimaryKey(pad(key, down.MAX_KEY, keyTail), primaryKey);\n                                }\n                            },\n                            key: {\n                                get: function () {\n                                    var key = cursor.key;\n                                    return keyLength === 1 ?\n                                        key[0] :\n                                        key.slice(0, keyLength);\n                                }\n                            },\n                            value: {\n                                get: function () {\n                                    return cursor.value;\n                                }\n                            }\n                        });\n                        return virtualCursor;\n                    }\n                    return table.openCursor(translateRequest(req))\n                        .then(function (cursor) { return cursor && createVirtualCursor(cursor); });\n                } });\n            return result;\n        } });\n}\nvar virtualIndexMiddleware = {\n    stack: \"dbcore\",\n    name: \"VirtualIndexMiddleware\",\n    level: 1,\n    create: createVirtualIndexMiddleware\n};\n\nvar hooksMiddleware = {\n    stack: \"dbcore\",\n    name: \"HooksMiddleware\",\n    level: 2,\n    create: function (downCore) { return (__assign(__assign({}, downCore), { table: function (tableName) {\n            var downTable = downCore.table(tableName);\n            var primaryKey = downTable.schema.primaryKey;\n            var tableMiddleware = __assign(__assign({}, downTable), { mutate: function (req) {\n                    var dxTrans = PSD.trans;\n                    var _a = dxTrans.table(tableName).hook, deleting = _a.deleting, creating = _a.creating, updating = _a.updating;\n                    switch (req.type) {\n                        case 'add':\n                            if (creating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                        case 'put':\n                            if (creating.fire === nop && updating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                        case 'delete':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', function () { return addPutOrDelete(req); }, true);\n                        case 'deleteRange':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', function () { return deleteRange(req); }, true);\n                    }\n                    return downTable.mutate(req);\n                    function addPutOrDelete(req) {\n                        var dxTrans = PSD.trans;\n                        var keys$$1 = req.keys || getEffectiveKeys(primaryKey, req);\n                        if (!keys$$1)\n                            throw new Error(\"Keys missing\");\n                        req = req.type === 'add' || req.type === 'put' ? __assign(__assign({}, req), { keys: keys$$1, wantResults: true }) :\n                         __assign({}, req);\n                        if (req.type !== 'delete')\n                            req.values = __spreadArrays(req.values);\n                        if (req.keys)\n                            req.keys = __spreadArrays(req.keys);\n                        return getExistingValues(downTable, req, keys$$1).then(function (existingValues) {\n                            var contexts = keys$$1.map(function (key, i) {\n                                var existingValue = existingValues[i];\n                                var ctx = { onerror: null, onsuccess: null };\n                                if (req.type === 'delete') {\n                                    deleting.fire.call(ctx, key, existingValue, dxTrans);\n                                }\n                                else if (req.type === 'add' || existingValue === undefined) {\n                                    var generatedPrimaryKey = creating.fire.call(ctx, key, req.values[i], dxTrans);\n                                    if (key == null && generatedPrimaryKey != null) {\n                                        key = generatedPrimaryKey;\n                                        req.keys[i] = key;\n                                        if (!primaryKey.outbound) {\n                                            setByKeyPath(req.values[i], primaryKey.keyPath, key);\n                                        }\n                                    }\n                                }\n                                else {\n                                    var objectDiff = getObjectDiff(existingValue, req.values[i]);\n                                    var additionalChanges_1 = updating.fire.call(ctx, objectDiff, key, existingValue, dxTrans);\n                                    if (additionalChanges_1) {\n                                        var requestedValue_1 = req.values[i];\n                                        Object.keys(additionalChanges_1).forEach(function (keyPath) {\n                                            if (hasOwn(requestedValue_1, keyPath)) {\n                                                requestedValue_1[keyPath] = additionalChanges_1[keyPath];\n                                            }\n                                            else {\n                                                setByKeyPath(requestedValue_1, keyPath, additionalChanges_1[keyPath]);\n                                            }\n                                        });\n                                    }\n                                }\n                                return ctx;\n                            });\n                            return downTable.mutate(req).then(function (_a) {\n                                var failures = _a.failures, results = _a.results, numFailures = _a.numFailures, lastResult = _a.lastResult;\n                                for (var i = 0; i < keys$$1.length; ++i) {\n                                    var primKey = results ? results[i] : keys$$1[i];\n                                    var ctx = contexts[i];\n                                    if (primKey == null) {\n                                        ctx.onerror && ctx.onerror(failures[i]);\n                                    }\n                                    else {\n                                        ctx.onsuccess && ctx.onsuccess(req.type === 'put' && existingValues[i] ?\n                                            req.values[i] :\n                                            primKey\n                                        );\n                                    }\n                                }\n                                return { failures: failures, results: results, numFailures: numFailures, lastResult: lastResult };\n                            }).catch(function (error) {\n                                contexts.forEach(function (ctx) { return ctx.onerror && ctx.onerror(error); });\n                                return Promise.reject(error);\n                            });\n                        });\n                    }\n                    function deleteRange(req) {\n                        return deleteNextChunk(req.trans, req.range, 10000);\n                    }\n                    function deleteNextChunk(trans, range, limit) {\n                        return downTable.query({ trans: trans, values: false, query: { index: primaryKey, range: range }, limit: limit })\n                            .then(function (_a) {\n                            var result = _a.result;\n                            return addPutOrDelete({ type: 'delete', keys: result, trans: trans }).then(function (res) {\n                                if (res.numFailures > 0)\n                                    return Promise.reject(res.failures[0]);\n                                if (result.length < limit) {\n                                    return { failures: [], numFailures: 0, lastResult: undefined };\n                                }\n                                else {\n                                    return deleteNextChunk(trans, __assign(__assign({}, range), { lower: result[result.length - 1], lowerOpen: true }), limit);\n                                }\n                            });\n                        });\n                    }\n                } });\n            return tableMiddleware;\n        } })); }\n};\n\nvar Dexie =               (function () {\n    function Dexie(name, options) {\n        var _this = this;\n        this._middlewares = {};\n        this.verno = 0;\n        var deps = Dexie.dependencies;\n        this._options = options = __assign({\n            addons: Dexie.addons, autoOpen: true,\n            indexedDB: deps.indexedDB, IDBKeyRange: deps.IDBKeyRange }, options);\n        this._deps = {\n            indexedDB: options.indexedDB,\n            IDBKeyRange: options.IDBKeyRange\n        };\n        var addons = options.addons;\n        this._dbSchema = {};\n        this._versions = [];\n        this._storeNames = [];\n        this._allTables = {};\n        this.idbdb = null;\n        var state = {\n            dbOpenError: null,\n            isBeingOpened: false,\n            onReadyBeingFired: null,\n            openComplete: false,\n            dbReadyResolve: nop,\n            dbReadyPromise: null,\n            cancelOpen: nop,\n            openCanceller: null,\n            autoSchema: true\n        };\n        state.dbReadyPromise = new DexiePromise(function (resolve) {\n            state.dbReadyResolve = resolve;\n        });\n        state.openCanceller = new DexiePromise(function (_, reject) {\n            state.cancelOpen = reject;\n        });\n        this._state = state;\n        this.name = name;\n        this.on = Events(this, \"populate\", \"blocked\", \"versionchange\", { ready: [promisableChain, nop] });\n        this.on.ready.subscribe = override(this.on.ready.subscribe, function (subscribe) {\n            return function (subscriber, bSticky) {\n                Dexie.vip(function () {\n                    var state = _this._state;\n                    if (state.openComplete) {\n                        if (!state.dbOpenError)\n                            DexiePromise.resolve().then(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else if (state.onReadyBeingFired) {\n                        state.onReadyBeingFired.push(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else {\n                        subscribe(subscriber);\n                        var db_1 = _this;\n                        if (!bSticky)\n                            subscribe(function unsubscribe() {\n                                db_1.on.ready.unsubscribe(subscriber);\n                                db_1.on.ready.unsubscribe(unsubscribe);\n                            });\n                    }\n                });\n            };\n        });\n        this.Collection = createCollectionConstructor(this);\n        this.Table = createTableConstructor(this);\n        this.Transaction = createTransactionConstructor(this);\n        this.Version = createVersionConstructor(this);\n        this.WhereClause = createWhereClauseConstructor(this);\n        this.on(\"versionchange\", function (ev) {\n            if (ev.newVersion > 0)\n                console.warn(\"Another connection wants to upgrade database '\" + _this.name + \"'. Closing db now to resume the upgrade.\");\n            else\n                console.warn(\"Another connection wants to delete database '\" + _this.name + \"'. Closing db now to resume the delete request.\");\n            _this.close();\n        });\n        this.on(\"blocked\", function (ev) {\n            if (!ev.newVersion || ev.newVersion < ev.oldVersion)\n                console.warn(\"Dexie.delete('\" + _this.name + \"') was blocked\");\n            else\n                console.warn(\"Upgrade '\" + _this.name + \"' blocked by other connection holding version \" + ev.oldVersion / 10);\n        });\n        this._maxKey = getMaxKey(options.IDBKeyRange);\n        this._createTransaction = function (mode, storeNames, dbschema, parentTransaction) { return new _this.Transaction(mode, storeNames, dbschema, parentTransaction); };\n        this._fireOnBlocked = function (ev) {\n            _this.on(\"blocked\").fire(ev);\n            connections\n                .filter(function (c) { return c.name === _this.name && c !== _this && !c._state.vcFired; })\n                .map(function (c) { return c.on(\"versionchange\").fire(ev); });\n        };\n        this.use(virtualIndexMiddleware);\n        this.use(hooksMiddleware);\n        addons.forEach(function (addon) { return addon(_this); });\n    }\n    Dexie.prototype.version = function (versionNumber) {\n        if (isNaN(versionNumber) || versionNumber < 0.1)\n            throw new exceptions.Type(\"Given version is not a positive number\");\n        versionNumber = Math.round(versionNumber * 10) / 10;\n        if (this.idbdb || this._state.isBeingOpened)\n            throw new exceptions.Schema(\"Cannot add version when database is open\");\n        this.verno = Math.max(this.verno, versionNumber);\n        var versions = this._versions;\n        var versionInstance = versions.filter(function (v) { return v._cfg.version === versionNumber; })[0];\n        if (versionInstance)\n            return versionInstance;\n        versionInstance = new this.Version(versionNumber);\n        versions.push(versionInstance);\n        versions.sort(lowerVersionFirst);\n        versionInstance.stores({});\n        this._state.autoSchema = false;\n        return versionInstance;\n    };\n    Dexie.prototype._whenReady = function (fn) {\n        var _this = this;\n        return this._state.openComplete || PSD.letThrough ? fn() : new DexiePromise(function (resolve, reject) {\n            if (!_this._state.isBeingOpened) {\n                if (!_this._options.autoOpen) {\n                    reject(new exceptions.DatabaseClosed());\n                    return;\n                }\n                _this.open().catch(nop);\n            }\n            _this._state.dbReadyPromise.then(resolve, reject);\n        }).then(fn);\n    };\n    Dexie.prototype.use = function (_a) {\n        var stack = _a.stack, create = _a.create, level = _a.level, name = _a.name;\n        if (name)\n            this.unuse({ stack: stack, name: name });\n        var middlewares = this._middlewares[stack] || (this._middlewares[stack] = []);\n        middlewares.push({ stack: stack, create: create, level: level == null ? 10 : level, name: name });\n        middlewares.sort(function (a, b) { return a.level - b.level; });\n        return this;\n    };\n    Dexie.prototype.unuse = function (_a) {\n        var stack = _a.stack, name = _a.name, create = _a.create;\n        if (stack && this._middlewares[stack]) {\n            this._middlewares[stack] = this._middlewares[stack].filter(function (mw) {\n                return create ? mw.create !== create :\n                    name ? mw.name !== name :\n                        false;\n            });\n        }\n        return this;\n    };\n    Dexie.prototype.open = function () {\n        return dexieOpen(this);\n    };\n    Dexie.prototype.close = function () {\n        var idx = connections.indexOf(this), state = this._state;\n        if (idx >= 0)\n            connections.splice(idx, 1);\n        if (this.idbdb) {\n            try {\n                this.idbdb.close();\n            }\n            catch (e) { }\n            this.idbdb = null;\n        }\n        this._options.autoOpen = false;\n        state.dbOpenError = new exceptions.DatabaseClosed();\n        if (state.isBeingOpened)\n            state.cancelOpen(state.dbOpenError);\n        state.dbReadyPromise = new DexiePromise(function (resolve) {\n            state.dbReadyResolve = resolve;\n        });\n        state.openCanceller = new DexiePromise(function (_, reject) {\n            state.cancelOpen = reject;\n        });\n    };\n    Dexie.prototype.delete = function () {\n        var _this = this;\n        var hasArguments = arguments.length > 0;\n        var state = this._state;\n        return new DexiePromise(function (resolve, reject) {\n            var doDelete = function () {\n                _this.close();\n                var req = _this._deps.indexedDB.deleteDatabase(_this.name);\n                req.onsuccess = wrap(function () {\n                    databaseEnumerator.remove(_this.name);\n                    resolve();\n                });\n                req.onerror = eventRejectHandler(reject);\n                req.onblocked = _this._fireOnBlocked;\n            };\n            if (hasArguments)\n                throw new exceptions.InvalidArgument(\"Arguments not allowed in db.delete()\");\n            if (state.isBeingOpened) {\n                state.dbReadyPromise.then(doDelete);\n            }\n            else {\n                doDelete();\n            }\n        });\n    };\n    Dexie.prototype.backendDB = function () {\n        return this.idbdb;\n    };\n    Dexie.prototype.isOpen = function () {\n        return this.idbdb !== null;\n    };\n    Dexie.prototype.hasBeenClosed = function () {\n        var dbOpenError = this._state.dbOpenError;\n        return dbOpenError && (dbOpenError.name === 'DatabaseClosed');\n    };\n    Dexie.prototype.hasFailed = function () {\n        return this._state.dbOpenError !== null;\n    };\n    Dexie.prototype.dynamicallyOpened = function () {\n        return this._state.autoSchema;\n    };\n    Object.defineProperty(Dexie.prototype, \"tables\", {\n        get: function () {\n            var _this = this;\n            return keys(this._allTables).map(function (name) { return _this._allTables[name]; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Dexie.prototype.transaction = function () {\n        var args = extractTransactionArgs.apply(this, arguments);\n        return this._transaction.apply(this, args);\n    };\n    Dexie.prototype._transaction = function (mode, tables, scopeFunc) {\n        var _this = this;\n        var parentTransaction = PSD.trans;\n        if (!parentTransaction || parentTransaction.db !== this || mode.indexOf('!') !== -1)\n            parentTransaction = null;\n        var onlyIfCompatible = mode.indexOf('?') !== -1;\n        mode = mode.replace('!', '').replace('?', '');\n        var idbMode, storeNames;\n        try {\n            storeNames = tables.map(function (table) {\n                var storeName = table instanceof _this.Table ? table.name : table;\n                if (typeof storeName !== 'string')\n                    throw new TypeError(\"Invalid table argument to Dexie.transaction(). Only Table or String are allowed\");\n                return storeName;\n            });\n            if (mode == \"r\" || mode === READONLY)\n                idbMode = READONLY;\n            else if (mode == \"rw\" || mode == READWRITE)\n                idbMode = READWRITE;\n            else\n                throw new exceptions.InvalidArgument(\"Invalid transaction mode: \" + mode);\n            if (parentTransaction) {\n                if (parentTransaction.mode === READONLY && idbMode === READWRITE) {\n                    if (onlyIfCompatible) {\n                        parentTransaction = null;\n                    }\n                    else\n                        throw new exceptions.SubTransaction(\"Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY\");\n                }\n                if (parentTransaction) {\n                    storeNames.forEach(function (storeName) {\n                        if (parentTransaction && parentTransaction.storeNames.indexOf(storeName) === -1) {\n                            if (onlyIfCompatible) {\n                                parentTransaction = null;\n                            }\n                            else\n                                throw new exceptions.SubTransaction(\"Table \" + storeName +\n                                    \" not included in parent transaction.\");\n                        }\n                    });\n                }\n                if (onlyIfCompatible && parentTransaction && !parentTransaction.active) {\n                    parentTransaction = null;\n                }\n            }\n        }\n        catch (e) {\n            return parentTransaction ?\n                parentTransaction._promise(null, function (_, reject) { reject(e); }) :\n                rejection(e);\n        }\n        var enterTransaction = enterTransactionScope.bind(null, this, idbMode, storeNames, parentTransaction, scopeFunc);\n        return (parentTransaction ?\n            parentTransaction._promise(idbMode, enterTransaction, \"lock\") :\n            PSD.trans ?\n                usePSD(PSD.transless, function () { return _this._whenReady(enterTransaction); }) :\n                this._whenReady(enterTransaction));\n    };\n    Dexie.prototype.table = function (tableName) {\n        if (!hasOwn(this._allTables, tableName)) {\n            throw new exceptions.InvalidTable(\"Table \" + tableName + \" does not exist\");\n        }\n        return this._allTables[tableName];\n    };\n    return Dexie;\n}());\n\nvar Dexie$1 = Dexie;\nprops(Dexie$1, __assign(__assign({}, fullNameExceptions), {\n    delete: function (databaseName) {\n        var db = new Dexie$1(databaseName);\n        return db.delete();\n    },\n    exists: function (name) {\n        return new Dexie$1(name, { addons: [] }).open().then(function (db) {\n            db.close();\n            return true;\n        }).catch('NoSuchDatabaseError', function () { return false; });\n    },\n    getDatabaseNames: function (cb) {\n        return databaseEnumerator ?\n            databaseEnumerator.getDatabaseNames().then(cb) :\n            DexiePromise.resolve([]);\n    },\n    defineClass: function () {\n        function Class(content) {\n            extend(this, content);\n        }\n        return Class;\n    },\n    ignoreTransaction: function (scopeFunc) {\n        return PSD.trans ?\n            usePSD(PSD.transless, scopeFunc) :\n            scopeFunc();\n    },\n    vip: vip, async: function (generatorFn) {\n        return function () {\n            try {\n                var rv = awaitIterator(generatorFn.apply(this, arguments));\n                if (!rv || typeof rv.then !== 'function')\n                    return DexiePromise.resolve(rv);\n                return rv;\n            }\n            catch (e) {\n                return rejection(e);\n            }\n        };\n    }, spawn: function (generatorFn, args, thiz) {\n        try {\n            var rv = awaitIterator(generatorFn.apply(thiz, args || []));\n            if (!rv || typeof rv.then !== 'function')\n                return DexiePromise.resolve(rv);\n            return rv;\n        }\n        catch (e) {\n            return rejection(e);\n        }\n    },\n    currentTransaction: {\n        get: function () { return PSD.trans || null; }\n    }, waitFor: function (promiseOrFunction, optionalTimeout) {\n        var promise = DexiePromise.resolve(typeof promiseOrFunction === 'function' ?\n            Dexie$1.ignoreTransaction(promiseOrFunction) :\n            promiseOrFunction)\n            .timeout(optionalTimeout || 60000);\n        return PSD.trans ?\n            PSD.trans.waitFor(promise) :\n            promise;\n    },\n    Promise: DexiePromise,\n    debug: {\n        get: function () { return debug; },\n        set: function (value) {\n            setDebug(value, value === 'dexie' ? function () { return true; } : dexieStackFrameFilter);\n        }\n    },\n    derive: derive, extend: extend, props: props, override: override,\n    Events: Events,\n    getByKeyPath: getByKeyPath, setByKeyPath: setByKeyPath, delByKeyPath: delByKeyPath, shallowClone: shallowClone, deepClone: deepClone, getObjectDiff: getObjectDiff, asap: asap,\n    minKey: minKey,\n    addons: [],\n    connections: connections,\n    errnames: errnames,\n    dependencies: (function () {\n        try {\n            return {\n                indexedDB: _global.indexedDB || _global.mozIndexedDB || _global.webkitIndexedDB || _global.msIndexedDB,\n                IDBKeyRange: _global.IDBKeyRange || _global.webkitIDBKeyRange\n            };\n        }\n        catch (e) {\n            return { indexedDB: null, IDBKeyRange: null };\n        }\n    })(),\n    semVer: DEXIE_VERSION, version: DEXIE_VERSION.split('.')\n        .map(function (n) { return parseInt(n); })\n        .reduce(function (p, c, i) { return p + (c / Math.pow(10, i * 2)); }),\n    default: Dexie$1,\n    Dexie: Dexie$1 }));\nDexie$1.maxKey = getMaxKey(Dexie$1.dependencies.IDBKeyRange);\n\ninitDatabaseEnumerator(Dexie.dependencies.indexedDB);\nDexiePromise.rejectionMapper = mapError;\nsetDebug(debug, dexieStackFrameFilter);\n\nexport default Dexie;\nexport { Dexie };\n//# sourceMappingURL=dexie.mjs.map\n"],"sourceRoot":""}